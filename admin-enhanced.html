<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Nexus Admin - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            font-size: 42px;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.6);
        }

        .stat-card-title {
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tabs-container {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.6);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
        }

        .content-area {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 30px;
            min-height: 500px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .user-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.6);
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }

        .user-info h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .user-id {
            font-size: 14px;
            opacity: 0.7;
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #f093fb;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .action-btn {
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-add {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .btn-remove {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.8), rgba(220, 38, 38, 0.8));
        }

        .btn-status {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.8), rgba(234, 179, 8, 0.8));
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .withdraw-request {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .withdraw-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }

        .status-completed {
            background: rgba(76, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid #4ade80;
        }

        .login-form {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 16px;
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="loginForm" class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px; font-size: 28px;">üîê Admin Panel</h2>
        <div class="form-group">
            <label>–õ–æ–≥–∏–Ω</label>
            <input type="text" id="login" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
        </div>
        <div class="form-group">
            <label>–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        <button class="btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
    </div>

    <div id="adminPanel" class="hidden">
        <div class="header">
            <h1>‚öõÔ∏è Quantum Nexus Admin</h1>
            <p>–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card" onclick="switchTab('users')">
                <div class="stat-card-title">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
                <div class="stat-card-value" id="totalUsers">0</div>
            </div>
            <div class="stat-card" onclick="switchTab('revenue')">
                <div class="stat-card-title">üí∞ –û–±—â–∏–π –¥–æ—Ö–æ–¥</div>
                <div class="stat-card-value" id="totalRevenue">0</div>
            </div>
            <div class="stat-card" onclick="switchTab('activity')">
                <div class="stat-card-title">‚ö° –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                <div class="stat-card-value" id="totalActivity">0</div>
            </div>
            <div class="stat-card" onclick="switchTab('withdrawals')">
                <div class="stat-card-title">üí∏ –ó–∞—è–≤–∫–∏</div>
                <div class="stat-card-value" id="totalWithdrawals">0</div>
            </div>
        </div>

        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="tab-btn" onclick="switchTab('withdrawals')">üí∏ –í—ã–≤–æ–¥—ã</button>
            <button class="tab-btn" onclick="switchTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="switchTab('logs')">üìù –õ–æ–≥–∏</button>
            <button class="tab-btn" onclick="switchTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab-btn" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
        </div>

        <div class="content-area" id="content">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <script>
        const ADMIN_LOGIN = 'smartfixnsk';
        const ADMIN_PASSWORD = 'Maga1996';

        window.addEventListener('load', () => {
            if (localStorage.getItem('admin_logged_in') === 'true') {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadDashboard();
            }
        });

        function login() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;

            if (login === ADMIN_LOGIN && password === ADMIN_PASSWORD) {
                localStorage.setItem('admin_logged_in', 'true');
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadDashboard();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
            }
        }

        function logout() {
            localStorage.removeItem('admin_logged_in');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            loadTab(tabName);
        }

        function loadDashboard() {
            fetch('/api/admin/stats')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('totalUsers').textContent = data.total_users || 0;
                    document.getElementById('totalRevenue').textContent = formatNumber(data.total_revenue || 0);
                    document.getElementById('totalActivity').textContent = formatNumber(data.total_activity || 0);
                    document.getElementById('totalWithdrawals').textContent = data.pending_withdrawals || 0;
                });

            loadTab('users');
        }

        function loadTab(tabName) {
            const content = document.getElementById('content');
            
            if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'withdrawals') {
                loadWithdrawals();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'logs') {
                content.innerHTML = '<div class="loading">–õ–æ–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</div>';
            } else if (tabName === 'settings') {
                content.innerHTML = '<div class="loading">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>';
            }
        }

        function loadUsers() {
            fetch('/api/admin/users')
                .then(res => res.json())
                .then(data => {
                    const content = document.getElementById('content');
                    if (data.users && data.users.length > 0) {
                        content.innerHTML = '<div style="display: grid; gap: 20px;">' +
                            data.users.map(user => `
                                <div class="user-card">
                                    <div class="user-header">
                                        <div class="user-info">
                                            <h3>${user.username || 'Unknown'}</h3>
                                            <div class="user-id">ID: ${user.telegram_id}</div>
                                            ${user.is_banned ? '<span class="status-badge status-pending">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>' : ''}
                                            ${user.is_frozen ? '<span class="status-badge status-pending">‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∂–µ–Ω</span>' : ''}
                                        </div>
                                    </div>
                                    <div class="user-stats">
                                        <div class="stat-item">
                                            <div class="stat-label">üí∞ –ö–æ–∏–Ω—ã</div>
                                            <div class="stat-value">${formatNumber(user.coins)}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">üíé QuanHash</div>
                                            <div class="stat-value">${formatNumber(user.quanhash)}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
                                            <div class="stat-value">${user.energy}/${user.max_energy}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">üëÜ –¢–∞–ø–æ–≤</div>
                                            <div class="stat-value">${formatNumber(user.total_taps)}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">üíµ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                                            <div class="stat-value">${formatNumber(user.total_earned)}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">üë• –†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>
                                            <div class="stat-value">${user.referrals_count}</div>
                                        </div>
                                    </div>
                                    <div class="action-grid">
                                        <button class="action-btn btn-add" onclick="modifyUser(${user.telegram_id}, 'add_coins', 10000)">+10k ü™ô</button>
                                        <button class="action-btn btn-add" onclick="modifyUser(${user.telegram_id}, 'add_coins', 100000)">+100k ü™ô</button>
                                        <button class="action-btn btn-add" onclick="modifyUser(${user.telegram_id}, 'add_quanhash', 10000)">+10k üíé</button>
                                        <button class="action-btn btn-remove" onclick="modifyUser(${user.telegram_id}, 'remove_coins', 5000)">-5k ü™ô</button>
                                        <button class="action-btn btn-remove" onclick="modifyUser(${user.telegram_id}, 'remove_quanhash', 5000)">-5k üíé</button>
                                        ${user.is_banned ? 
                                            '<button class="action-btn btn-status" onclick="modifyUser(' + user.telegram_id + ', \'unban\', \'\')">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>' :
                                            '<button class="action-btn btn-remove" onclick="modifyUser(' + user.telegram_id + ', \'ban\', \'Admin ban\')">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>'
                                        }
                                        ${user.is_frozen ? 
                                            '<button class="action-btn btn-status" onclick="modifyUser(' + user.telegram_id + ', \'unfreeze\', \'\')">üî• –†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å</button>' :
                                            '<button class="action-btn btn-status" onclick="modifyUser(' + user.telegram_id + ', \'freeze\', \'\')">‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å</button>'
                                        }
                                        <button class="action-btn btn-remove" onclick="modifyUser(${user.telegram_id}, 'reset', 0)">‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å</button>
                                    </div>
                                </div>
                            `).join('') + '</div>';
                    } else {
                        content.innerHTML = '<div class="loading">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                    }
                })
                .catch(err => {
                    document.getElementById('content').innerHTML = '<div style="color: red; text-align: center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                });
        }

        function loadWithdrawals() {
            fetch('/api/admin/withdrawals')
                .then(res => res.json())
                .then(data => {
                    const content = document.getElementById('content');
                    if (data.requests && data.requests.length > 0) {
                        content.innerHTML = '<div style="display: grid; gap: 20px;">' +
                            data.requests.map(req => `
                                <div class="withdraw-request">
                                    <div class="withdraw-header">
                                        <div>
                                            <h3>–ó–∞—è–≤–∫–∞ #${req.id}</h3>
                                            <div style="font-size: 14px; opacity: 0.7;">${new Date(req.created_at).toLocaleString()}</div>
                                        </div>
                                        <span class="status-badge ${req.status === 'pending' ? 'status-pending' : 'status-completed'}">
                                            ${req.status === 'pending' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç' : '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ'}
                                        </span>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                                        <div class="stat-item">
                                            <div class="stat-label">User ID</div>
                                            <div class="stat-value">${req.user_id}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">QuanHash</div>
                                            <div class="stat-value">${formatNumber(req.amount)}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">USDT</div>
                                            <div class="stat-value">$${req.usdt_amount}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">–ê–¥—Ä–µ—Å</div>
                                            <div class="stat-value" style="font-size: 12px; word-break: break-all;">${req.address}</div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 15px;">
                                        <button class="action-btn btn-add" onclick="processWithdrawal(${req.id}, 'completed')" style="margin-right: 10px;">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
                                        <button class="action-btn btn-remove" onclick="processWithdrawal(${req.id}, 'rejected')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                    </div>
                                </div>
                            `).join('') + '</div>';
                    } else {
                        content.innerHTML = '<div class="loading">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</div>';
                    }
                });
        }

        function loadStats() {
            fetch('/api/admin/stats')
                .then(res => res.json())
                .then(data => {
                    const content = document.getElementById('content');
                    content.innerHTML = `
                        <div style="display: grid; gap: 20px;">
                            <div class="stat-card">
                                <div class="stat-card-title">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                <div class="stat-card-value">${data.total_users || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                                <div class="stat-card-value">${formatNumber(data.total_taps || 0)}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">–ó–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</div>
                                <div class="stat-card-value">${data.pending_withdrawals || 0}</div>
                            </div>
                        </div>
                    `;
                });
        }

        function modifyUser(userId, action, value) {
            if (!confirm(`–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ: ${action}, –ó–Ω–∞—á–µ–Ω–∏–µ: ${value}`)) return;
            
            fetch('/api/admin/modify_user', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: userId, action: action, value: value})
            })
            .then(() => loadUsers());
        }

        function processWithdrawal(requestId, status) {
            fetch('/api/admin/process_withdrawal', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({request_id: requestId, status: status})
            })
            .then(() => loadWithdrawals());
        }

        function formatNumber(num) {
            return Math.floor(num || 0).toLocaleString('ru');
        }

        function setEnergy(userId, maxEnergy) {
            fetch('/api/admin/set_energy', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: userId, energy: maxEnergy})
            })
            .then(() => loadUsers());
        }
    </script>
</body>
</html>

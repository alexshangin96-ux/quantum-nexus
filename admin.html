<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚛️ Quantum Nexus Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #667eea; --secondary: #764ba2; --accent: #f093fb;
            --danger: #ef4444; --success: #4ade80; --warning: #fbbf24;
            --dark: #0f172a; --darker: #0a0e27;
            --card: rgba(15, 23, 42, 0.95); --border: rgba(102, 126, 234, 0.3);
        }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: #fff; min-height: 100vh; padding: 15px;
        }
        .particles {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0; opacity: 0.3;
        }
        .particle {
            position: absolute; width: 3px; height: 3px;
            background: var(--primary); border-radius: 50%; animation: float 15s infinite;
        }
        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; } }
        .container { max-width: 1600px; margin: 0 auto; position: relative; z-index: 1; }
        .login-container {
            max-width: 400px; margin: 60px auto; background: var(--card);
            border: 1px solid var(--border); border-radius: 16px; padding: 30px;
            animation: slideIn 0.3s;
        }
        .login-title { font-size: 32px; text-align: center; margin-bottom: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 13px; opacity: 0.8; }
        .form-group input {
            width: 100%; padding: 10px 14px; background: rgba(255,255,255,0.08);
            border: 1px solid var(--border); border-radius: 10px; color: white;
            font-size: 14px; transition: all 0.2s;
        }
        .form-group input:focus { outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102,126,234,0.2);
        }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,0.4); }
        .header {
            background: var(--card); border: 1px solid var(--border); border-radius: 16px;
            padding: 20px 25px; margin-bottom: 15px; display: flex;
            justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 24px; margin: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .header-right { display: flex; gap: 10px; }
        .header-btn { padding: 8px 16px; background: rgba(255,255,255,0.08);
            border: 1px solid var(--border); border-radius: 8px; color: white;
            cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;
        }
        .header-btn:hover { background: rgba(102,126,234,0.2); }
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px; margin-bottom: 15px;
        }
        .stat-card {
            background: var(--card); border: 1px solid var(--border); border-radius: 12px;
            padding: 16px; text-align: center; transition: all 0.2s;
        }
        .stat-card:hover { transform: translateY(-3px); border-color: var(--primary); }
        .stat-icon { font-size: 28px; margin-bottom: 8px; }
        .stat-label { font-size: 11px; opacity: 0.7; margin-bottom: 6px; text-transform: uppercase; }
        .stat-value { font-size: 24px; font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .tabs-container {
            background: var(--card); border: 1px solid var(--border); border-radius: 12px;
            padding: 6px; margin-bottom: 15px; display: flex; gap: 6px; flex-wrap: wrap;
        }
        .tab-btn {
            padding: 8px 16px; background: transparent; border: 1px solid transparent;
            border-radius: 8px; color: white; cursor: pointer; font-size: 13px;
            font-weight: 600; transition: all 0.2s;
        }
        .tab-btn:hover { background: rgba(102,126,234,0.1); }
        .tab-btn.active { background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
        }
        .content-area {
            background: var(--card); border: 1px solid var(--border); border-radius: 16px;
            padding: 20px; min-height: 500px;
        }
        .search-container { margin-bottom: 15px; position: relative; }
        .search-input {
            width: 100%; padding: 10px 40px 10px 14px; background: rgba(255,255,255,0.06);
            border: 1px solid var(--border); border-radius: 10px; color: white;
            font-size: 14px; transition: all 0.2s;
        }
        .search-input:focus { outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102,126,234,0.2);
        }
        .users-grid { display: grid; gap: 12px; }
        .user-card {
            background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(118,75,162,0.08));
            border: 1px solid var(--border); border-radius: 12px; padding: 14px;
            transition: all 0.2s;
        }
        .user-card:hover { transform: translateX(4px); border-color: var(--primary); }
        .user-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid var(--border);
        }
        .user-info h3 { font-size: 16px; margin-bottom: 4px; }
        .user-id { font-size: 11px; opacity: 0.6; }
        .user-badges { display: flex; gap: 6px; }
        .badge { padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: bold; }
        .badge-banned { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid #ef4444; }
        .badge-frozen { background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid #fbbf24; }
        .stats-grid-mini {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;
        }
        .stat-item {
            background: rgba(102,126,234,0.1); padding: 10px; border-radius: 8px;
            border: 1px solid rgba(102,126,234,0.2);
        }
        .stat-label-small { font-size: 9px; opacity: 0.7; margin-bottom: 4px; text-transform: uppercase; }
        .stat-value-small { font-size: 16px; font-weight: bold; color: var(--accent); }
        .actions-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .action-btn {
            padding: 8px; border-radius: 8px; border: none; cursor: pointer;
            font-weight: bold; transition: all 0.2s; color: white; font-size: 11px;
        }
        .action-btn:hover { transform: translateY(-2px); }
        .btn-add { background: linear-gradient(135deg, var(--primary), var(--secondary)); }
        .btn-remove { background: linear-gradient(135deg, rgba(239,68,68,0.8), rgba(220,38,38,0.8)); }
        .btn-status { background: linear-gradient(135deg, rgba(251,191,36,0.8), rgba(234,179,8,0.8)); }
        .btn-success { background: linear-gradient(135deg, rgba(76,222,128,0.8), rgba(34,197,94,0.8)); }
        .btn-reset { background: linear-gradient(135deg, rgba(239,68,68,0.7), rgba(220,38,38,0.7));
            width: 100%; margin-top: 8px;
        }
        .notification {
            position: fixed; top: 20px; right: 20px; background: var(--card);
            border: 1px solid var(--border); border-radius: 12px; padding: 12px 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); animation: slideIn 0.3s;
            z-index: 99999; max-width: 350px; font-size: 13px;
        }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;
        }
        .modal.active { display: flex; animation: slideIn 0.2s; }
        .modal-content {
            background: var(--card); border: 1px solid var(--border); border-radius: 16px;
            padding: 24px; max-width: 500px; width: 90%;
        }
        .modal-title { font-size: 18px; margin-bottom: 16px; font-weight: bold; }
        .modal-input {
            width: 100%; padding: 10px; background: rgba(255,255,255,0.08);
            border: 1px solid var(--border); border-radius: 8px; color: white; margin-bottom: 12px;
        }
        .modal-actions { display: flex; gap: 10px; }
        .btn-modal { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; }
        .hidden { display: none !important; }
        .notification.success { border-left: 3px solid var(--success); }
        .notification.error { border-left: 3px solid var(--danger); }
        .notification.info { border-left: 3px solid var(--primary); }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div id="notification" class="notification hidden"><div id="notification-text"></div></div>
    <div class="modal" id="quickEditModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">Быстрое редактирование</h2>
            <input type="number" class="modal-input" id="modalInput" placeholder="Введите значение">
            <div class="modal-actions">
                <button class="btn-modal" style="background: rgba(255,255,255,0.1); color: white;" onclick="closeModal()">Отмена</button>
                <button class="btn-modal btn" onclick="confirmQuickEdit()">Применить</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="loginForm" class="login-container">
            <h2 class="login-title">⚛️ Admin</h2>
            <div class="form-group"><label>Логин</label><input type="text" id="login" placeholder="smartfixnsk"></div>
            <div class="form-group"><label>Пароль</label><input type="password" id="password" placeholder="••••••••"></div>
            <button class="btn" onclick="login()">Войти</button>
        </div>

        <div id="adminPanel" class="admin-panel hidden container">
            <div class="header">
                <div class="header-left"><h1>⚛️ Quantum Nexus</h1></div>
                <div class="header-right">
                    <button class="header-btn" onclick="refreshAll()">🔄 Обновить</button>
                    <button class="header-btn" onclick="logout()">🚪 Выйти</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><span class="stat-icon">👥</span><div class="stat-label">Пользователи</div><div class="stat-value" id="totalUsers">0</div></div>
                <div class="stat-card"><span class="stat-icon">💰</span><div class="stat-label">Доход</div><div class="stat-value" id="totalRevenue">0</div></div>
                <div class="stat-card"><span class="stat-icon">⚡</span><div class="stat-label">Активность</div><div class="stat-value" id="totalActivity">0</div></div>
                <div class="stat-card"><span class="stat-icon">💸</span><div class="stat-label">Заявки</div><div class="stat-value" id="totalWithdrawals">0</div></div>
                <div class="stat-card"><span class="stat-icon">👆</span><div class="stat-label">Тапы</div><div class="stat-value" id="totalTaps">0</div></div>
                <div class="stat-card"><span class="stat-icon">🔗</span><div class="stat-label">Рефералы</div><div class="stat-value" id="totalReferrals">0</div></div>
            </div>

            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('users')">👥 Пользователи</button>
                <button class="tab-btn" onclick="switchTab('withdrawals')">💸 Выводы</button>
                <button class="tab-btn" onclick="switchTab('stats')">📊 Аналитика</button>
                <button class="tab-btn" onclick="switchTab('settings')">⚙️ Настройки</button>
            </div>

            <div class="content-area" id="content"><div style="text-align: center; padding: 40px;">Загрузка...</div></div>
        </div>
    </div>

    <script>
        const ADMIN_LOGIN = 'smartfixnsk', ADMIN_PASSWORD = 'Maga1996';
        let quickEditData = null;
        
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const p = document.createElement('div'); p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.top = Math.random() * 100 + '%';
                p.style.animationDelay = Math.random() * 15 + 's';
                container.appendChild(p);
            }
        }
        
        function showNotification(message, type = 'info') {
            const n = document.getElementById('notification');
            n.classList.remove('hidden', 'success', 'error', 'info');
            n.classList.add(type);
            document.getElementById('notification-text').textContent = message;
            setTimeout(() => n.classList.add('hidden'), 3000);
        }

        function openQuickEdit(userId, field, title) {
            quickEditData = { userId, field };
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalInput').value = '';
            document.getElementById('quickEditModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('quickEditModal').classList.remove('active');
            quickEditData = null;
        }

        function confirmQuickEdit() {
            if (!quickEditData) return;
            const value = parseFloat(document.getElementById('modalInput').value);
            if (isNaN(value)) { showNotification('❌ Введите корректное значение', 'error'); return; }
            modifyUser(quickEditData.userId, `set_${quickEditData.field}`, value);
            closeModal();
        }

        window.addEventListener('load', () => {
            createParticles();
            if (localStorage.getItem('admin_logged_in') === 'true') initPanel();
        });

        function login() {
            const l = document.getElementById('login').value;
            const p = document.getElementById('password').value;
            if (l === ADMIN_LOGIN && p === ADMIN_PASSWORD) {
                localStorage.setItem('admin_logged_in', 'true');
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                initPanel();
                showNotification('✅ Авторизация успешна', 'success');
            } else { showNotification('❌ Неверный логин или пароль', 'error'); }
        }

        function logout() {
            localStorage.removeItem('admin_logged_in');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        function initPanel() {
            loadDashboard(); loadUsers();
        }

        function loadDashboard() {
            fetch('/api/admin/stats').then(res => res.json()).then(data => {
                document.getElementById('totalUsers').textContent = formatNumber(data.total_users || 0);
                document.getElementById('totalRevenue').textContent = formatNumber(data.total_revenue || 0);
                document.getElementById('totalActivity').textContent = formatNumber(data.active_users || 0);
                document.getElementById('totalWithdrawals').textContent = formatNumber(data.pending_withdrawals || 0);
                document.getElementById('totalTaps').textContent = formatNumber(data.total_taps || 0);
                document.getElementById('totalReferrals').textContent = formatNumber(data.total_referrals || 0);
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            loadTab(tabName);
        }

        function loadTab(tabName) {
            const c = document.getElementById('content');
            if (tabName === 'users') loadUsers();
            else if (tabName === 'withdrawals') loadWithdrawals();
            else if (tabName === 'stats') loadStats();
            else if (tabName === 'settings') loadSettings();
        }

        function loadUsers() {
            const c = document.getElementById('content');
            c.innerHTML = '<div style="text-align: center; padding: 20px;">Загрузка...</div>';
            
            fetch('/api/admin/users').then(res => res.json()).then(data => {
                if (data.users && data.users.length > 0) {
                    window.allUsers = data.users;
                    renderUsers(data.users);
                } else { c.innerHTML = '<div style="text-align: center; padding: 40px;">Нет пользователей</div>'; }
            }).catch(err => { c.innerHTML = '<div style="color: #ef4444; text-align: center;">Ошибка загрузки</div>'; });
        }

        function renderUsers(users) {
            const c = document.getElementById('content');
            c.innerHTML = `
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="🔍 Поиск..." onkeyup="filterUsers()">
                </div>
                <div class="users-grid" id="usersList">
                    ${users.map(u => createUserCard(u)).join('')}
                </div>
            `;
        }

        function createUserCard(user) {
            return `
                <div class="user-card">
                    <div class="user-header">
                        <div class="user-info">
                            <h3>${user.username || 'Unknown'}</h3>
                            <div class="user-id">ID: ${user.telegram_id}</div>
                        </div>
                        <div class="user-badges">
                            ${user.is_banned ? '<span class="badge badge-banned">🔒</span>' : ''}
                            ${user.is_frozen ? '<span class="badge badge-frozen">❄️</span>' : ''}
                        </div>
                    </div>
                    <div class="stats-grid-mini">
                        <div class="stat-item"><div class="stat-label-small">💰 Коины</div><div class="stat-value-small">${formatNumber(user.coins)}</div></div>
                        <div class="stat-item"><div class="stat-label-small">💎 Hash</div><div class="stat-value-small">${formatNumber(user.quanhash)}</div></div>
                        <div class="stat-item"><div class="stat-label-small">⚡ Энергия</div><div class="stat-value-small">${user.energy}/${user.max_energy}</div></div>
                    </div>
                    <div class="actions-grid">
                        <button class="action-btn btn-add" onclick="quickEdit(${user.telegram_id}, 'coins', '💰 Коины')" title="Изменить коины">💰</button>
                        <button class="action-btn btn-add" onclick="modifyUser(${user.telegram_id}, 'add_coins', 10000)">+10k</button>
                        <button class="action-btn btn-add" onclick="modifyUser(${user.telegram_id}, 'add_quanhash', 10000)">+10k💎</button>
                        <button class="action-btn btn-status" onclick="setEnergy(${user.telegram_id}, ${user.max_energy})">⚡</button>
                        ${user.is_banned ? '<button class="action-btn btn-success" onclick="modifyUser(' + user.telegram_id + ', \'unban\', \'\')">🔓</button>' : '<button class="action-btn btn-status" onclick="modifyUser(' + user.telegram_id + ', \'ban\', \'Admin ban\')">🔒</button>'}
                    </div>
                    <button class="action-btn btn-reset" onclick="modifyUser(${user.telegram_id}, 'reset', 0)">⚠️ Сбросить</button>
                </div>
            `;
        }

        function quickEdit(userId, field, title) { openQuickEdit(userId, field, title); }
        
        function filterUsers() {
            const s = document.getElementById('searchInput').value.toLowerCase();
            const f = window.allUsers.filter(u => 
                (u.username && u.username.toLowerCase().includes(s)) ||
                u.telegram_id.toString().includes(s)
            );
            document.getElementById('usersList').innerHTML = f.map(u => createUserCard(u)).join('');
        }

        function modifyUser(userId, action, value) {
            fetch('/api/admin/modify_user', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: userId, action: action, value: value})
            }).then(() => { showNotification('✅ Изменения применены', 'success'); loadUsers(); });
        }

        function setEnergy(userId, maxEnergy) {
            fetch('/api/admin/set_energy', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: userId, energy: maxEnergy})
            }).then(() => { showNotification('⚡ Энергия восстановлена', 'success'); loadUsers(); });
        }

        function loadWithdrawals() {
            const c = document.getElementById('content');
            c.innerHTML = '<div style="text-align: center; padding: 20px;">Загрузка...</div>';
            fetch('/api/admin/withdrawals').then(res => res.json()).then(data => {
                if (data.requests && data.requests.length > 0) {
                    c.innerHTML = data.requests.map(r => `
                        <div class="user-card" style="margin-bottom: 12px;">
                            <h3 style="font-size: 14px; margin-bottom: 10px;">Заявка #${r.id}</h3>
                            <div style="font-size: 12px; margin-bottom: 8px;">
                                <div>User: ${r.user_id}</div>
                                <div>QuanHash: ${formatNumber(r.amount)}</div>
                                <div>USDT: $${r.usdt_amount}</div>
                                <div style="font-family: monospace; font-size: 10px; word-break: break-all; margin-top: 6px;">${r.address}</div>
                            </div>
                            ${r.status === 'pending' ? `
                                <div style="display: flex; gap: 8px;">
                                    <button class="action-btn btn-success" style="flex: 1;" onclick="processWithdrawal(${r.id}, 'completed')">✅</button>
                                    <button class="action-btn btn-remove" style="flex: 1;" onclick="processWithdrawal(${r.id}, 'rejected')">❌</button>
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                } else { c.innerHTML = '<div style="text-align: center; padding: 40px;">Нет заявок</div>'; }
            });
        }

        function processWithdrawal(rid, status) {
            fetch('/api/admin/process_withdrawal', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({request_id: rid, status: status})
            }).then(() => { showNotification(status === 'completed' ? '✅ Одобрено' : '❌ Отклонено', status === 'completed' ? 'success' : 'error'); loadWithdrawals(); });
        }

        function loadStats() {
            const c = document.getElementById('content');
            fetch('/api/admin/stats').then(res => res.json()).then(data => {
                c.innerHTML = `
                    <div style="display: grid; gap: 12px;">
                        <div class="stat-card"><span class="stat-icon">👥</span><div class="stat-label">Пользователей</div><div class="stat-value">${formatNumber(data.total_users || 0)}</div></div>
                        <div class="stat-card"><span class="stat-icon">👆</span><div class="stat-label">Всего тапов</div><div class="stat-value">${formatNumber(data.total_taps || 0)}</div></div>
                    </div>
                `;
            });
        }

        function loadSettings() {
            document.getElementById('content').innerHTML = '<div style="text-align: center; padding: 40px;">Настройки в разработке</div>';
        }

        function refreshAll() { loadDashboard(); loadUsers(); showNotification('🔄 Обновлено', 'success'); }
        function formatNumber(num) { return Math.floor(num || 0).toLocaleString('ru'); }
        document.getElementById('password')?.addEventListener('keypress', e => { if (e.key === 'Enter') login(); });
    </script>
</body>
</html>
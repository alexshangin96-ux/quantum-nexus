#!/bin/bash

# Quantum Nexus v6.7.34 - Referral System FINAL
# Equal card heights, mobile optimized, equal bonuses
# Date: 2025-11-03

echo "=================================================="
echo "Quantum Nexus v6.7.34 - Referral System FINAL"
echo "=================================================="
echo ""
echo "Changes:"
echo "  âœ… Equal card heights with flexbox"
echo "  âœ… Mobile optimized (500px, 95vw)"
echo "  âœ… Fixed close button position"
echo "  âœ… VIP-style golden header"
echo "  âœ… Layered background effect"
echo "  âœ… Equal bonuses: 500/2000 for BOTH"
echo "  âœ… General income display"
echo ""

cd /root/quantum-nexus

echo "Step 1: Remove backup files..."
rm -f web_app.html.backup web_server.py.backup 2>/dev/null

echo "Step 2: Pull latest changes..."
git pull origin main

echo "Step 3: Backup database..."
sudo -u postgres pg_dump quantum_nexus > /root/backup-$(date +%Y%m%d-%H%M%S).sql 2>/dev/null

echo "Step 4: Apply migration if needed..."
sudo -u postgres psql quantum_nexus -f ADD_IS_PREMIUM.sql 2>/dev/null || echo "Already migrated"

echo "Step 5: Copy files..."
sudo cp web_app.html /var/www/quantum-nexus/
sudo cp web_server.py /var/www/quantum-nexus/
sudo cp handlers.py /var/www/quantum-nexus/
sudo cp models.py /var/www/quantum-nexus/
sudo cp config.py /var/www/quantum-nexus/

echo "Step 6: Restart services..."
sudo systemctl restart quantum-nexus-web.service
sudo systemctl restart quantum-nexus.service

echo "Step 7: Check status..."
sudo systemctl status quantum-nexus-web.service --no-pager
echo ""
sudo systemctl status quantum-nexus.service --no-pager

echo ""
echo "=================================================="
echo "âœ… v6.7.34 deployed successfully!"
echo "=================================================="
echo ""
echo "Bonus System:"
echo "  â€¢ Regular: 500 ðŸª™ (each gets same)"
echo "  â€¢ Premium: 2000 ðŸª™ (each gets same)"
echo "  â€¢ Passive: 5% regular / 10% premium"
echo ""
echo "Design:"
echo "  â€¢ VIP-style golden header"
echo "  â€¢ Layered background effect"
echo "  â€¢ Equal card heights"
echo "  â€¢ Mobile optimized"
echo "  â€¢ Professional layout"
echo ""


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚛️ Quantum Nexus Admin - Ultimate Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #8b5cf6; --secondary: #6366f1; --accent: #a78bfa; --info: #06b6d4;
            --danger: #ef4444; --success: #10b981; --warning: #f59e0b;
            --dark: #0f172a; --card: rgba(30, 41, 59, 0.7);
            --border: rgba(99, 102, 241, 0.2); --glass: rgba(255, 255, 255, 0.04);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at 30% 50%, #1e293b 0%, #0f172a 50%, #1e293b 100%);
            background-size: 200% 200%;
            animation: bgPulse 20s ease infinite;
            color: #e2e8f0; min-height: 100vh; padding: 15px;
            overflow-x: hidden;
        }
        @keyframes bgPulse {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        @keyframes particle {
            0%, 100% { transform: translate(0,0) rotate(0deg); opacity: 0.2; }
            50% { transform: translate(40px,-50px) rotate(180deg); opacity: 0.6; }
        }
        @keyframes float {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        .particles {
            position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0.3;
        }
        .particle {
            position: absolute; width: 3px; height: 3px; background: var(--primary);
            border-radius: 50%; animation: particle 15s infinite;
            box-shadow: 0 0 10px var(--primary);
        }
        .container { max-width: 1800px; margin: 0 auto; position: relative; z-index: 1; }
        
        .login-container {
            max-width: 420px; margin: 80px auto;
            background: rgba(30, 41, 59, 0.98);
            backdrop-filter: blur(30px); border: 2px solid rgba(139, 92, 246, 0.5);
            border-radius: 28px; padding: 50px 40px;
            box-shadow: 0 25px 80px rgba(139, 92, 246, 0.4),
                        0 0 100px rgba(139, 92, 246, 0.2);
            animation: float 0.6s;
            position: relative; overflow: hidden;
        }
        .login-container::before {
            content: ''; position: absolute; top: -200%; left: -200%;
            width: 400%; height: 400%;
            background: linear-gradient(45deg, transparent, rgba(139, 92, 246, 0.15), transparent);
            animation: shine 8s infinite;
        }
        @keyframes shine {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .login-title {
            font-size: 36px; text-align: center; margin-bottom: 30px;
            font-weight: 900; color: #fff;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.8),
                         0 0 40px rgba(139, 92, 246, 0.5);
            letter-spacing: -1px;
        }
        .login-icon {
            font-size: 72px; margin: 0 auto 30px; display: block;
            text-align: center; color: #fff;
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.9))
                    drop-shadow(0 0 40px rgba(139, 92, 246, 0.5));
            animation: glow 3s infinite;
        }
        .form-group { margin-bottom: 24px; position: relative; z-index: 1; }
        .form-group input {
            width: 100%; padding: 18px 22px; background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.4); border-radius: 16px;
            color: #fff; font-size: 17px; transition: all 0.4s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .form-group input::placeholder { color: rgba(255, 255, 255, 0.3); }
        .form-group input:focus {
            outline: none; border-color: rgba(139, 92, 246, 0.8);
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 0 0 5px rgba(139, 92, 246, 0.2),
                        0 0 40px rgba(139, 92, 246, 0.5);
            transform: translateY(-2px);
        }
        .btn {
            width: 100%; padding: 20px; border: none; border-radius: 16px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white; font-weight: 800; font-size: 17px; cursor: pointer;
            transition: all 0.4s; position: relative; overflow: hidden;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.5),
                        0 0 60px rgba(139, 92, 246, 0.3);
        }
        .btn::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 0; height: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s;
        }
        .btn:hover::before { width: 400px; height: 400px; }
        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 50px rgba(139, 92, 246, 0.6),
                        0 0 80px rgba(139, 92, 246, 0.4);
        }
        
        .header {
            background: var(--card); backdrop-filter: blur(25px); border: 1px solid var(--border);
            border-radius: 22px; padding: 22px 30px; margin-bottom: 18px;
            display: flex; justify-content: space-between; align-items: center;
            animation: float 0.3s;
        }
        .header h1 {
            font-size: 26px; margin: 0;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 800; letter-spacing: -0.5px;
        }
        .header-right { display: flex; gap: 10px; }
        .header-btn {
            padding: 9px 18px; background: var(--glass); border: 1px solid var(--border);
            border-radius: 12px; color: #cbd5e1; cursor: pointer; font-size: 13px;
            font-weight: 600; transition: all 0.3s;
        }
        .header-btn:hover {
            background: rgba(99, 102, 241, 0.2); border-color: var(--primary);
            color: #fff; transform: translateY(-2px);
        }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px; margin-bottom: 18px;
        }
        .stat-card {
            background: var(--card); backdrop-filter: blur(25px); border: 1px solid var(--border);
            border-radius: 16px; padding: 18px; text-align: center; transition: all 0.3s;
            cursor: pointer; position: relative; overflow: hidden;
        }
        .stat-card::before {
            content: ''; position: absolute; top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.15), transparent);
            opacity: 0; transition: opacity 0.3s;
        }
        .stat-card:hover::before { opacity: 1; }
        .stat-card:hover {
            transform: translateY(-4px) scale(1.02); border-color: var(--primary);
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.25);
        }
        .stat-icon { font-size: 32px; margin-bottom: 10px; filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.5)); }
        .stat-label {
            font-size: 10px; color: #94a3b8; margin-bottom: 8px;
            text-transform: uppercase; letter-spacing: 1px; font-weight: 700;
        }
        .stat-value {
            font-size: 26px; font-weight: 900;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        .tabs-container {
            background: var(--card); backdrop-filter: blur(25px); border: 1px solid var(--border);
            border-radius: 16px; padding: 8px; margin-bottom: 18px;
            display: flex; gap: 8px; flex-wrap: wrap;
        }
        .tab-btn {
            padding: 11px 22px; background: transparent; border: none; border-radius: 12px;
            color: #94a3b8; cursor: pointer; font-size: 13px; font-weight: 600;
            transition: all 0.3s;
        }
        .tab-btn:hover { background: rgba(99, 102, 241, 0.1); color: #fff; }
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff; box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
        }
        
        .content-area {
            background: var(--card); backdrop-filter: blur(25px);
            border: 1px solid var(--border); border-radius: 22px; padding: 25px;
            min-height: 700px; animation: float 0.3s;
        }
        
        .search-container { margin-bottom: 18px; position: relative; }
        .search-input {
            width: 100%; padding: 14px 50px 14px 18px; background: var(--glass);
            border: 1px solid var(--border); border-radius: 14px; color: #fff;
            font-size: 15px; transition: all 0.3s;
        }
        .search-input:focus {
            outline: none; border-color: var(--primary); background: rgba(99, 102, 241, 0.1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
        }
        
        .users-grid { display: grid; gap: 14px; }
        .user-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.08));
            backdrop-filter: blur(15px); border: 1px solid var(--border);
            border-radius: 16px; padding: 18px; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .user-card::before {
            content: ''; position: absolute; top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.15), transparent);
            opacity: 0; transition: opacity 0.3s;
        }
        .user-card:hover::before { opacity: 1; }
        .user-card:hover {
            transform: translateX(6px) scale(1.01); border-color: var(--primary);
            box-shadow: 0 12px 50px rgba(139, 92, 246, 0.2);
        }
        .user-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 14px; padding-bottom: 12px; border-bottom: 1px solid var(--border);
            position: relative; z-index: 1;
        }
        .user-info h3 { font-size: 17px; margin-bottom: 5px; color: #fff; font-weight: 800; }
        .user-id { font-size: 11px; color: #94a3b8; }
        .user-badges { display: flex; gap: 6px; flex-wrap: wrap; }
        .badge {
            padding: 4px 10px; border-radius: 14px; font-size: 10px; font-weight: 700;
            border: 1px solid;
        }
        .badge-banned { background: rgba(239, 68, 68, 0.15); color: #ef4444; border-color: #ef4444; }
        .badge-frozen { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border-color: #f59e0b; }
        .badge-vip { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border-color: #8b5cf6; }
        
        .stats-grid-mini {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 14px;
            position: relative; z-index: 1;
        }
        .stat-item {
            background: rgba(99, 102, 241, 0.08); backdrop-filter: blur(10px);
            padding: 12px; border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.3s;
        }
        .stat-item:hover { background: rgba(99, 102, 241, 0.15); transform: translateY(-2px); }
        .stat-label-small { font-size: 9px; color: #94a3b8; margin-bottom: 6px;
            text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700;
        }
        .stat-value-small { font-size: 18px; font-weight: 900; color: #a78bfa; }
        
        .actions-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 6px;
            position: relative; z-index: 1;
        }
        .action-btn {
            padding: 9px 6px; border-radius: 10px; border: none; cursor: pointer;
            font-weight: 700; transition: all 0.3s; color: white; font-size: 11px;
            position: relative; overflow: hidden;
        }
        .action-btn::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 0; height: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%); transition: width 0.4s, height 0.4s;
        }
        .action-btn:hover::before { width: 200px; height: 200px; }
        .action-btn:hover { transform: translateY(-3px); }
        .btn-add { background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        .btn-remove { background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        .btn-status { background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .btn-info { background: linear-gradient(135deg, #06b6d4, #0891b2);
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
        }
        .btn-reset {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.7), rgba(220, 38, 38, 0.7));
            width: 100%; margin-top: 10px; grid-column: 1/-1;
        }
        
        .notification {
            position: fixed; top: 20px; right: 20px; background: var(--card);
            backdrop-filter: blur(25px); border: 1px solid var(--border); border-radius: 14px;
            padding: 14px 18px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            animation: float 0.3s; z-index: 99999; max-width: 320px;
            font-size: 13px; font-weight: 600;
        }
        .notification.success { border-left: 4px solid var(--success); }
        .notification.error { border-left: 4px solid var(--danger); }
        .notification.info { border-left: 4px solid var(--primary); }
        .notification.warning { border-left: 4px solid var(--warning); }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(12px);
            z-index: 100000; align-items: center; justify-content: center;
        }
        .modal.active { display: flex; animation: float 0.2s; }
        .modal-content {
            background: var(--card); backdrop-filter: blur(25px); border: 1px solid var(--border);
            border-radius: 22px; padding: 26px; max-width: 420px; width: 90%;
            position: relative; z-index: 1;
        }
        .modal-title { font-size: 19px; margin-bottom: 18px; font-weight: 800; color: #fff; }
        .modal-input {
            width: 100%; padding: 14px; background: var(--glass); border: 1px solid var(--border);
            border-radius: 14px; color: white; font-size: 15px; margin-bottom: 16px;
        }
        .modal-actions { display: flex; gap: 10px; }
        .btn-modal { flex: 1; padding: 12px; border: none; border-radius: 14px; cursor: pointer; }
        .hidden { display: none !important; }
        
        .tab-content { animation: float 0.3s; }
        .loading { text-align: center; padding: 50px 20px; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div id="notification" class="notification hidden"><div id="notification-text"></div></div>
    <div class="modal" id="quickEditModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">Редактирование</h2>
            <input type="number" class="modal-input" id="modalInput" placeholder="Введите значение">
            <div class="modal-actions">
                <button class="btn-modal" style="background: var(--glass); color: #94a3b8;" onclick="closeModal()">Отмена</button>
                <button class="btn-modal btn" onclick="confirmQuickEdit()">Применить</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="loginForm" class="login-container">
            <div class="login-icon">⚛️</div>
            <div class="login-title">Quantum Nexus</div>
            <div class="form-group">
                <input type="text" id="login" placeholder="Login" autocomplete="username">
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Password" autocomplete="current-password">
            </div>
            <button class="btn" onclick="login()">🚀 Войти</button>
        </div>

        <div id="adminPanel" class="admin-panel hidden container">
            <div class="header">
                <div class="header-left"><h1>⚛️ Quantum Nexus - Admin Control</h1></div>
                <div class="header-right">
                    <button class="header-btn" onclick="refreshAll()">🔄</button>
                    <button class="header-btn" onclick="exportData()">📥</button>
                    <button class="header-btn" onclick="toggleTheme()">🌙</button>
                    <button class="header-btn" onclick="logout()">🚪</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card" onclick="switchTab('users')">
                    <span class="stat-icon">👥</span><div class="stat-label">Пользователи</div>
                    <div class="stat-value" id="totalUsers">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('revenue')">
                    <span class="stat-icon">💰</span><div class="stat-label">Доход</div>
                    <div class="stat-value" id="totalRevenue">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('activity')">
                    <span class="stat-icon">⚡</span><div class="stat-label">Активность</div>
                    <div class="stat-value" id="totalActivity">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('withdrawals')">
                    <span class="stat-icon">💸</span><div class="stat-label">Заявки</div>
                    <div class="stat-value" id="totalWithdrawals">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('taps')">
                    <span class="stat-icon">👆</span><div class="stat-label">Тапы</div>
                    <div class="stat-value" id="totalTaps">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('referrals')">
                    <span class="stat-icon">🔗</span><div class="stat-label">Рефералы</div>
                    <div class="stat-value" id="totalReferrals">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('online')">
                    <span class="stat-icon">🟢</span><div class="stat-label">Онлайн</div>
                    <div class="stat-value" id="totalOnline">0</div>
                </div>
                <div class="stat-card" onclick="switchTab('machines')">
                    <span class="stat-icon">🔧</span><div class="stat-label">Машины</div>
                    <div class="stat-value" id="totalMachines">0</div>
                </div>
            </div>

            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('users')">👥 Пользователи</button>
                <button class="tab-btn" onclick="switchTab('withdrawals')">💸 Выводы</button>
                <button class="tab-btn" onclick="switchTab('stats')">📊 Статистика</button>
                <button class="tab-btn" onclick="switchTab('analytics')">📈 Аналитика</button>
                <button class="tab-btn" onclick="switchTab('logs')">📝 Логи</button>
                <button class="tab-btn" onclick="switchTab('settings')">⚙️ Настройки</button>
                <button class="tab-btn" onclick="switchTab('security')">🔒 Безопасность</button>
                <button class="tab-btn" onclick="switchTab('tools')">🛠️ Инструменты</button>
            </div>

            <div class="content-area" id="content"><div class="loading">Загрузка...</div></div>
        </div>
    </div>

    <script>
        const ADMIN_LOGIN='smartfixnsk',ADMIN_PASSWORD='Maga1996';
        let quickEditData=null,logs=[],currentUser=null;
        function createParticles(){const c=document.getElementById('particles');for(let i=0;i<50;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.top=Math.random()*100+'%';p.style.animationDelay=Math.random()*15+'s';c.appendChild(p);}}
        function showNotification(m,t='info'){const n=document.getElementById('notification');n.classList.remove('hidden','success','error','info','warning');n.classList.add(t);document.getElementById('notification-text').textContent=m;setTimeout(()=>n.classList.add('hidden'),4000);}
        function addLog(m,t='info'){logs.unshift({message:`[${new Date().toLocaleString()}] ${m}`,type:t});if(logs.length>300)logs.pop();}
        function displayLogs(){const c=document.getElementById('content');if(logs.length===0){c.innerHTML='<div class="loading">Нет логов</div>';return;}c.innerHTML=`<h2 style="font-size:20px;margin-bottom:16px;color:#fff;font-weight:800;">📝 Системные логи (${logs.length})</h2><div style="max-height:600px;overflow-y:auto;">${logs.map(l=>`<div style="background:var(--glass);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:10px;font-size:12px;font-family:monospace;border-left:4px solid ${l.type==='success'?'#10b981':l.type==='error'?'#ef4444':l.type==='warning'?'#f59e0b':'#6366f1'}">${l.message}</div>`).join('')}</div>`;}
        function openQuickEdit(uid,field,title){quickEditData={userId:uid,field};document.getElementById('modalTitle').textContent=title;document.getElementById('modalInput').value='';document.getElementById('quickEditModal').classList.add('active');}
        function closeModal(){document.getElementById('quickEditModal').classList.remove('active');quickEditData=null;}
        function confirmQuickEdit(){if(!quickEditData)return;const v=parseFloat(document.getElementById('modalInput').value);if(isNaN(v)){showNotification('❌ Введите значение','error');return;}modifyUser(quickEditData.userId,`set_${quickEditData.field}`,v);closeModal();}
        window.addEventListener('load',()=>{createParticles();addLog('Система загружена','success');if(localStorage.getItem('admin_logged_in')==='true'){document.getElementById('loginForm').classList.add('hidden');document.getElementById('adminPanel').classList.remove('hidden');initPanel();}});
        function login(){const l=document.getElementById('login')?.value,p=document.getElementById('password')?.value;if(!l||!p){showNotification('❌ Заполните все поля','error');return;}if(l===ADMIN_LOGIN&&p===ADMIN_PASSWORD){localStorage.setItem('admin_logged_in','true');document.getElementById('loginForm').classList.add('hidden');document.getElementById('adminPanel').classList.remove('hidden');initPanel();addLog('Вход выполнен','success');showNotification('✅ Добро пожаловать','success');}else{showNotification('❌ Неверный логин или пароль','error');addLog('Ошибка входа','error');}}
        function logout(){localStorage.removeItem('admin_logged_in');document.getElementById('loginForm').classList.remove('hidden');document.getElementById('adminPanel').classList.add('hidden');addLog('Выход','info');}
        function refreshAll(){loadDashboard();if(localStorage.getItem('active_tab')==='users')loadUsers();showNotification('🔄 Обновлено','success');}
        function exportData(){const data=JSON.stringify(window.allUsers||[],null,2);const blob=new Blob([data],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='users_export.json';a.click();showNotification('📥 Экспорт данных','success');}
        function toggleTheme(){const h=document.body;h.classList.toggle('dark-theme');showNotification('🌙 Тема изменена','info');}
        function initPanel(){loadDashboard();loadUsers();const saved=localStorage.getItem('active_tab');if(saved)loadTab(saved);}
        function loadDashboard(){const cached=localStorage.getItem('cached_stats');if(cached){const d=JSON.parse(cached);['totalUsers','totalRevenue','totalActivity','totalWithdrawals','totalTaps','totalReferrals'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.textContent=formatNumber([d.total_users||0,d.total_revenue||0,d.active_users||0,d.pending_withdrawals||0,d.total_taps||0,d.total_referrals||0][i]);});}fetch('/api/admin/stats').then(r=>r.json()).then(d=>{localStorage.setItem('cached_stats',JSON.stringify(d));['totalUsers','totalRevenue','totalActivity','totalWithdrawals','totalTaps','totalReferrals'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.textContent=formatNumber([d.total_users||0,d.total_revenue||0,d.active_users||0,d.pending_withdrawals||0,d.total_taps||0,d.total_referrals||0][i]);});document.getElementById('totalOnline').textContent=formatNumber(d.active_users||0);document.getElementById('totalMachines').textContent=formatNumber(d.total_machines||0);}).catch(()=>{});}
        function switchTab(t){localStorage.setItem('active_tab',t);document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');loadTab(t);}
        function loadTab(t){const c=document.getElementById('content');c.className='content-area';c.innerHTML='<div class="loading">Загрузка...</div>';if(t==='users')loadUsers();else if(t==='withdrawals')loadWithdrawals();else if(t==='stats')loadStats();else if(t==='analytics')loadAnalytics();else if(t==='logs')displayLogs();else if(t==='settings')loadSettings();else if(t==='security')loadSecurity();else if(t==='tools')loadTools();addLog(`Вкладка: ${t}`,'info');}
        function loadUsers(){const c=document.getElementById('content');c.innerHTML='<div class="loading">Загрузка...</div>';fetch('/api/admin/users').then(r=>r.json()).then(d=>{if(d.users&&d.users.length>0){window.allUsers=d.users;localStorage.setItem('cached_users',JSON.stringify(d.users));renderUsers(d.users);addLog(`Загружено ${d.users.length} пользователей`,'success');}else{c.innerHTML='<div class="loading">Нет пользователей</div>';}}).catch(e=>{const cached=localStorage.getItem('cached_users');if(cached&&JSON.parse(cached).length>0){window.allUsers=JSON.parse(cached);renderUsers(JSON.parse(cached));addLog('Кэш загружен','info');}else{c.innerHTML='<div style="color:#ef4444;text-align:center;">Ошибка</div>';addLog(`Ошибка: ${e.message}`,'error');}});}
        function renderUsers(u){const c=document.getElementById('content');const searchValue=localStorage.getItem('search_value')||'';c.innerHTML=`<div class="search-container"><input type="text" class="search-input" id="searchInput" value="${searchValue}" placeholder="🔍 Поиск..." onkeyup="filterUsers()"></div><div class="users-grid" id="usersList">${u.map(us=>createUserCard(us)).join('')}</div>`;if(searchValue)filterUsers();}
        function createUserCard(u){const actions30=['💰','💎','+10k🪙','+100k🪙','+10k💎','+100k💎','⚡MAX','🔒/🔓','❄️/🔥','💎Млн','-5k🪙','-5k💎','📊','🔔','🏆','⭐','🎁','🌐','📱','🔧','⚙️','📈','📉','🗑️','🔍','💾','📤','🎯','📌','🆔'];return `<div class="user-card" onclick="selectUser(${u.telegram_id})"><div class="user-header"><div class="user-info"><h3>${u.username||'Unknown'}</h3><div class="user-id">ID: ${u.telegram_id}</div></div><div class="user-badges">${u.is_banned?'<span class="badge badge-banned">🔒</span>':''}${u.is_frozen?'<span class="badge badge-frozen">❄️</span>':''}<span class="badge badge-vip">⭐</span></div></div><div class="stats-grid-mini"><div class="stat-item"><div class="stat-label-small">💰</div><div class="stat-value-small">${formatNumber(u.coins)}</div></div><div class="stat-item"><div class="stat-label-small">💎</div><div class="stat-value-small">${formatNumber(u.quanhash)}</div></div><div class="stat-item"><div class="stat-label-small">⚡</div><div class="stat-value-small">${u.energy}/${u.max_energy}</div></div></div><div class="actions-grid"><button class="action-btn btn-add" onclick="quickEdit(${u.telegram_id},'coins','💰 Коины')">💰</button><button class="action-btn btn-add" onclick="quickEdit(${u.telegram_id},'quanhash','💎 QuanHash')">💎</button><button class="action-btn btn-add" onclick="modifyUser(${u.telegram_id},'add_coins',10000)">+10k</button><button class="action-btn btn-add" onclick="modifyUser(${u.telegram_id},'add_coins',100000)">+100k</button><button class="action-btn btn-add" onclick="modifyUser(${u.telegram_id},'add_quanhash',10000)">+10k💎</button><button class="action-btn btn-add" onclick="modifyUser(${u.telegram_id},'add_quanhash',100000)">+100k💎</button><button class="action-btn btn-add" onclick="modifyUser(${u.telegram_id},'add_coins',1000000)">💎 Млн</button><button class="action-btn btn-info" onclick="viewUserDetails(${u.telegram_id})">📊</button></div><div class="actions-grid"><button class="action-btn btn-status" onclick="setEnergy(${u.telegram_id},${u.max_energy})">⚡</button><button class="action-btn btn-remove" onclick="modifyUser(${u.telegram_id},'remove_coins',5000)">-5k</button><button class="action-btn btn-remove" onclick="modifyUser(${u.telegram_id},'remove_quanhash',5000)">-5k💎</button><button class="action-btn btn-status" onclick="modifyUser(${u.telegram_id},'reset',0)">⚠️</button>${u.is_banned?'<button class="action-btn btn-success" onclick="modifyUser('+u.telegram_id+',\'unban\',\'\')">🔓</button>':'<button class="action-btn btn-status" onclick="modifyUser('+u.telegram_id+',\'ban\',\'Admin\')">🔒</button>'}${u.is_frozen?'<button class="action-btn btn-success" onclick="modifyUser('+u.telegram_id+',\'unfreeze\',\'\')">🔥</button>':'<button class="action-btn btn-status" onclick="modifyUser('+u.telegram_id+',\'freeze\',\'\')">❄️</button>'}${u.is_banned?'':'<button class="action-btn btn-info" onclick="viewUserDetails('+u.telegram_id+')">📋</button>'}</div></div>`;}
        function selectUser(uid){currentUser=uid;showNotification(`Пользователь #${uid} выбран`,'info');}
        function viewUserDetails(uid){const u=window.allUsers.find(us=>us.telegram_id===uid);if(!u){showNotification('Пользователь не найден','error');return;}alert(`Детали:\nКоины: ${u.coins}\nQuanHash: ${u.quanhash}\nТапы: ${u.total_taps}\nРефералы: ${u.referrals_count}\nЗаработано: ${u.total_earned}`);}
        function filterUsers(){const s=document.getElementById('searchInput').value.toLowerCase();localStorage.setItem('search_value',s);const f=window.allUsers.filter(u=>(u.username&&u.username.toLowerCase().includes(s))||u.telegram_id.toString().includes(s));document.getElementById('usersList').innerHTML=f.map(u=>createUserCard(u)).join('');}
        function modifyUser(uid,a,v){fetch('/api/admin/modify_user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:uid,action:a,value:v})}).then(()=>{showNotification('✅ Применено','success');addLog(`Изменение ${uid}: ${a}=${v}`,'success');loadUsers();});}
        function setEnergy(uid,m){fetch('/api/admin/set_energy',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:uid,energy:m})}).then(()=>{showNotification('⚡ Восстановлено','success');loadUsers();});}
        function loadWithdrawals(){const c=document.getElementById('content');c.innerHTML='<div class="loading">Загрузка...</div>';fetch('/api/admin/withdrawals').then(r=>r.json()).then(d=>{if(d.requests&&d.requests.length>0){c.innerHTML=`<h2 style="font-size:22px;margin-bottom:18px;color:#fff;font-weight:800;">💸 Заявки (${d.requests.length})</h2>${d.requests.map(r=>`<div class="user-card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;"><div><strong>#${r.id}</strong><div style="font-size:11px;color:#94a3b8;margin-top:4px;">${new Date(r.created_at).toLocaleString()}</div></div><span class="badge ${r.status==='pending'?'badge-frozen':'badge-success'}">${r.status==='pending'?'⏳':'✅'}</span></div><div style="font-size:12px;color:#cbd5e1;margin-bottom:12px;"><div>User: ${r.user_id}</div><div>QuanHash: ${formatNumber(r.amount)}</div><div>USDT: $${r.usdt_amount}</div><div style="font-family:monospace;font-size:10px;word-break:break-all;margin-top:8px;padding:8px;background:var(--glass);border-radius:10px;">${r.address}</div></div>${r.status==='pending'?`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;"><button class="action-btn btn-success" onclick="processWithdrawal(${r.id},'completed')">✅</button><button class="action-btn btn-remove" onclick="processWithdrawal(${r.id},'rejected')">❌</button></div>`:''}</div>`).join('');}else{c.innerHTML='<div class="loading">Нет заявок</div>';}});}
        function processWithdrawal(rid,status){fetch('/api/admin/process_withdrawal',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({request_id:rid,status:status})}).then(()=>{showNotification(status==='completed'?'✅ Одобрено':'❌ Отклонено',status==='completed'?'success':'error');addLog(`Заявка #${rid}: ${status}`,'success');loadWithdrawals();});}
        function loadStats(){const c=document.getElementById('content');fetch('/api/admin/stats').then(r=>r.json()).then(d=>{c.innerHTML=`<h2 style="font-size:22px;margin-bottom:18px;color:#fff;font-weight:800;">📊 Статистика</h2><div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">${['users','taps','withdrawals','coins','quanhash','referrals'].map(s=>`<div class="stat-card"><span class="stat-icon">${s==='users'?'👥':s==='taps'?'👆':s==='withdrawals'?'💸':s==='coins'?'💰':s==='quanhash'?'💎':'🔗'}</span><div class="stat-label">${['Пользователей','Тапов','Заявок','Коинов','QuanHash','Рефералов'][['users','taps','withdrawals','coins','quanhash','referrals'].indexOf(s)]}</div><div class="stat-value">${formatNumber(['total_users','total_taps','pending_withdrawals','total_coins','total_quanhash','total_referrals'][['users','taps','withdrawals','coins','quanhash','referrals'].indexOf(s)]?d[['total_users','total_taps','pending_withdrawals','total_coins','total_quanhash','total_referrals'][['users','taps','withdrawals','coins','quanhash','referrals'].indexOf(s)]]:0||0)}</div></div>`).join('')}</div>`);});}
        function loadAnalytics(){document.getElementById('content').innerHTML='<h2 style="font-size:22px;margin-bottom:18px;color:#fff;font-weight:800;">📈 Аналитика</h2><div class="stat-card"><span class="stat-icon">📊</span><div class="stat-label">Аналитика</div><div class="stat-value" style="font-size:18px;margin-top:10px;">В разработке</div></div>';}
        function loadSettings(){document.getElementById('content').innerHTML='<h2 style="font-size:22px;margin-bottom:18px;color:#fff;font-weight:800;">⚙️ Настройки</h2><div class="stat-card"><span class="stat-icon">⚙️</span><div class="stat-label">Настройки</div><div class="stat-value" style="font-size:18px;margin-top:10px;">В разработке</div></div>';}
        function loadSecurity(){document.getElementById('content').innerHTML='<h2 style="font-size:22px;margin-bottom:18px;color:#fff;font-weight:800;">🔒 Безопасность</h2><div class="stat-card"><span class="stat-icon">🔒</span><div class="stat-label">Безопасность</div><div class="stat-value" style="font-size:18px;margin-top:10px;">В разработке</div></div>';}
        function loadTools(){document.getElementById('content').innerHTML='<h2 style="font-size:22px;margin-bottom:18px;color:#fff;font-weight:800;">🛠️ Инструменты</h2><div class="stat-card"><span class="stat-icon">🛠️</span><div class="stat-label">Инструменты</div><div class="stat-value" style="font-size:18px;margin-top:10px;">В разработке</div></div>';}
        function formatNumber(n){return Math.floor(n||0).toLocaleString('ru');}
        window.addEventListener('DOMContentLoaded',()=>{const loginInput=document.getElementById('login');const passInput=document.getElementById('password');if(loginInput){loginInput.addEventListener('keypress',e=>{if(e.key==='Enter'){e.preventDefault();document.getElementById('password').focus();}});}if(passInput){passInput.addEventListener('keypress',e=>{if(e.key==='Enter'){e.preventDefault();login();}});}});
    </script>
</body>
</html>
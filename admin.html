<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öõÔ∏è Quantum Nexus Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8eaf6; min-height: 100vh; padding: 20px;
            overflow-x: hidden;
        }
        :root {
            --primary: #6366f1; --secondary: #8b5cf6; --accent: #a78bfa;
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
            --dark: rgba(15, 23, 42, 0.9); --card: rgba(30, 41, 59, 0.8);
        }
        
        .login-container {
            max-width: 400px; margin: 80px auto;
            background: var(--card); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 20px;
            padding: 40px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .login-title { font-size: 32px; text-align: center; margin-bottom: 30px; color: #fff; }
        .form-group { margin-bottom: 20px; }
        .form-group input {
            width: 100%; padding: 14px 18px; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 12px; color: #fff;
            font-size: 15px; transition: all 0.3s;
        }
        .form-group input:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; font-weight: 700; font-size: 16px; cursor: pointer;
            transition: all 0.3s; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }
        
        .header {
            background: var(--card); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 16px;
            padding: 20px 28px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 24px; margin: 0; color: #fff; }
        .header-right { display: flex; gap: 10px; }
        .header-btn {
            padding: 8px 16px; background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px;
            color: #fff; cursor: pointer; font-weight: 600; font-size: 13px;
            transition: all 0.3s;
        }
        .header-btn:hover { background: rgba(99, 102, 241, 0.3); transform: translateY(-2px); }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 14px; margin-bottom: 20px;
        }
        .stat-card {
            background: var(--card); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 16px;
            padding: 20px; text-align: center; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .stat-card:hover {
            transform: translateY(-4px); border-color: var(--primary);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.3);
        }
        .stat-icon { font-size: 36px; margin-bottom: 10px; }
        .stat-label { font-size: 11px; color: #94a3b8; margin-bottom: 8px; text-transform: uppercase; font-weight: 700; }
        .stat-value { font-size: 28px; font-weight: 800; color: #fff; }
        
        .tabs-container {
            background: var(--card); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 16px;
            padding: 8px; margin-bottom: 20px; display: flex; gap: 8px; flex-wrap: wrap;
        }
        .tab-btn {
            padding: 11px 20px; background: transparent; border: none; border-radius: 12px;
            color: #94a3b8; cursor: pointer; font-weight: 700; font-size: 13px;
            transition: all 0.3s;
        }
        .tab-btn:hover { background: rgba(139, 92, 246, 0.1); color: #fff; }
        .tab-btn.active {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: #fff; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .content-area {
            background: var(--card); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 20px;
            padding: 26px; min-height: 700px; box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .actions-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px; margin-top: 12px;
        }
        .action-btn {
            padding: 12px 16px; border-radius: 11px; border: 1px solid;
            cursor: pointer; font-weight: 700; font-size: 12px; transition: all 0.3s;
        }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .btn-edit { background: linear-gradient(135deg, #6366f1, #818cf8); color: #fff; border-color: #6366f1; }
        .btn-manage { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: #fff; border-color: #8b5cf6; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #f87171); color: #fff; border-color: #ef4444; }
        .btn-success { background: linear-gradient(135deg, #10b981, #34d399); color: #fff; border-color: #10b981; }
        
        .user-card {
            background: var(--card); border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px; padding: 20px; margin-bottom: 14px;
            transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .user-card:hover {
            transform: translateX(6px); border-color: var(--primary);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.3);
        }
        .user-header { display: flex; justify-content: space-between; margin-bottom: 14px; padding-bottom: 12px; border-bottom: 1px solid rgba(99, 102, 241, 0.2); }
        .user-info h3 { font-size: 18px; margin-bottom: 5px; color: #fff; }
        .user-id { font-size: 12px; color: #94a3b8; }
        
        .modal {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.7); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
            z-index: 100000; align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--card); border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px; padding: 28px; max-width: 450px; width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .modal-title { font-size: 20px; margin-bottom: 18px; color: #fff; font-weight: 800; }
        .modal-input {
            width: 100%; padding: 14px; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 11px;
            color: white; font-size: 15px; margin-bottom: 18px;
        }
        .modal-actions { display: flex; gap: 10px; }
        .btn-modal { flex: 1; padding: 12px; border: none; border-radius: 11px; cursor: pointer; font-weight: 700; }
        
        .hidden { display: none !important; }
        .loading { text-align: center; padding: 50px 20px; color: #94a3b8; font-size: 16px; }
        .notification {
            position: fixed; top: 20px; right: 20px; background: var(--card);
            border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 14px; padding: 14px 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); z-index: 99999; max-width: 320px; font-weight: 700;
        }
        
        .settings-grid, .security-grid, .tools-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px;
        }
        .setting-card, .security-card, .tool-card {
            background: var(--card); border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 14px; padding: 20px; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .setting-card:hover, .security-card:hover, .tool-card:hover {
            transform: translateY(-4px); border-color: var(--primary);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.3);
        }
        .card-title { font-size: 16px; margin-bottom: 10px; color: #fff; font-weight: 800; }
        .card-desc { font-size: 12px; color: #94a3b8; margin-bottom: 14px; }
        .card-actions { display: flex; gap: 8px; }
        .text-primary { color: #6366f1; }
        .text-secondary { color: #8b5cf6; }
    </style>
</head>
<body>
    <div id="loginForm" class="login-container">
        <div class="login-title">‚öõÔ∏è Quantum Nexus</div>
        <div class="form-group">
            <input type="text" id="login" placeholder="–õ–æ–≥–∏–Ω" autocomplete="username">
        </div>
        <div class="form-group">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
        </div>
        <button class="btn" id="loginBtn" type="button">üöÄ –í–æ–π—Ç–∏</button>
    </div>

    <div id="adminPanel" class="hidden">
        <div class="header">
            <div><h1>‚öõÔ∏è Quantum Nexus - Admin Control</h1></div>
            <div class="header-right">
                <button class="header-btn" onclick="refreshAll()">üîÑ</button>
                <button class="header-btn" onclick="exportData()">üì•</button>
                <button class="header-btn" onclick="logout()">üö™</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card" id="totalUsers">üë•<div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div><div class="stat-value">0</div></div>
            <div class="stat-card" id="totalRevenue">üí∞<div class="stat-label">–î–æ—Ö–æ–¥</div><div class="stat-value">0</div></div>
            <div class="stat-card" id="totalActivity">‚ö°<div class="stat-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div><div class="stat-value">0</div></div>
            <div class="stat-card" id="totalWithdrawals">üí∏<div class="stat-label">–ó–∞—è–≤–∫–∏</div><div class="stat-value">0</div></div>
        </div>

        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="tab-btn" onclick="switchTab('withdrawals')">üí∏ –í—ã–≤–æ–¥—ã<span id="withdrawalsBadge" style="background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:700;margin-left:10px;display:none;box-shadow:0 4px 12px rgba(245,158,11,0.4);"></span></button>
            <button class="tab-btn" onclick="switchTab('questions')">
                üí¨ –í–æ–ø—Ä–æ—Å—ã 
                <span id="questionsBadge" style="display:none;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;padding:2px 6px;border-radius:8px;font-size:10px;font-weight:700;margin-left:5px;">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('archive')">üìÅ –ê—Ä—Ö–∏–≤</button>
            <button class="tab-btn" onclick="switchTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="switchTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab-btn" onclick="switchTab('security')">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</button>
            <button class="tab-btn" onclick="switchTab('tools')">üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
        </div>

        <div class="content-area" id="content"><div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
    </div>

    <div class="modal" id="quickEditModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <input type="number" class="modal-input" id="modalInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
            <div class="modal-actions">
                <button class="btn-modal" style="background:rgba(99,102,241,0.2);color:#fff;" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-modal" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;" onclick="confirmQuickEdit()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_LOGIN='smartfixnsk'; const ADMIN_PASSWORD='Maga1996';
        let quickEditData=null, logs=[], currentUser=null;
        
        function login(){
            console.log('Login function called');
            const loginInput=document.getElementById('login');
            const passInput=document.getElementById('password');
            
            if(!loginInput||!passInput){
                alert('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                console.error('Login or password input not found');
                return false;
            }
            
            const l=loginInput.value.trim();
            const p=passInput.value.trim();
            
            console.log('Login attempt:', l, 'Password length:', p.length);
            
            if(!l){
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω');
                loginInput.focus();
                return false;
            }
            
            if(!p){
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                passInput.focus();
                return false;
            }
            
            if(l!==ADMIN_LOGIN){
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω');
                loginInput.focus();
                return false;
            }
            
            if(p!==ADMIN_PASSWORD){
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                passInput.focus();
                return false;
            }
            
            console.log('Login successful');
            localStorage.setItem('admin_logged_in','true');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            initPanel();
            return true;
        }
        
        window.addEventListener('load',function(){
            const loginBtn=document.getElementById('loginBtn');
            const passInput=document.getElementById('password');
            const loginInput=document.getElementById('login');
            
            if(loginBtn){
                loginBtn.addEventListener('click',function(e){
                    e.preventDefault();
                    login();
                });
                console.log('Login button handler attached on window load');
            }
            
            if(passInput){
                passInput.addEventListener('keypress',function(e){
                    if(e.key==='Enter'){
                        e.preventDefault();
                        login();
                    }
                });
            }
            
            if(loginInput){
                loginInput.addEventListener('keypress',function(e){
                    if(e.key==='Enter'){
                        e.preventDefault();
                        passInput.focus();
                    }
                });
            }
        });
        
        document.addEventListener('DOMContentLoaded',function(){
            const loginBtn=document.getElementById('loginBtn');
            if(loginBtn&&!loginBtn.hasAttribute('data-listener')){
                loginBtn.addEventListener('click',function(e){
                    e.preventDefault();
                    login();
                });
                loginBtn.setAttribute('data-listener','true');
                console.log('Login button handler attached on DOMContentLoaded');
            }
        });
        
        function logout(){localStorage.removeItem('admin_logged_in');document.getElementById('loginForm').classList.remove('hidden');document.getElementById('adminPanel').classList.add('hidden');}
        function refreshAll(){loadUsers();showNotification('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ');}
        function exportData(){const data=JSON.stringify(window.allUsers||[],null,2);const blob=new Blob([data],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='users_export.json';a.click();}
        function showNotification(m){const n=document.createElement('div');n.className='notification';n.textContent=m;document.body.appendChild(n);setTimeout(()=>document.body.removeChild(n),3000);}
        function switchTab(t){localStorage.setItem('active_tab',t);document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>{if(b.textContent.includes(['üë•','üí∏','üí¨','üìÅ'][['users','withdrawals','questions','archive'].indexOf(t)]))b.classList.add('active');});loadTab(t);}
        function loadTab(t){const c=document.getElementById('content');c.innerHTML='<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';if(t==='users')loadUsers();else if(t==='withdrawals')loadWithdrawals();else if(t==='questions')loadQuestions();else if(t==='archive')loadArchive();else if(t==='stats')loadStats();else if(t==='settings')loadSettings();else if(t==='security')loadSecurity();else if(t==='tools')loadTools();}
        let withdrawalCount = 0;
        let searchTimeout = null;
        
        function initPanel(){
            const saved=localStorage.getItem('active_tab');
            if(saved)loadTab(saved);
            else{loadTab('stats');loadStats();}
            // Check for unread questions and withdrawals count periodically
            setInterval(()=>{fetch('/api/admin/unread_count').then(r=>r.json()).then(d=>{const badgeEl=document.getElementById('questionsBadge');if(d.unread_count>0){badgeEl.textContent=d.unread_count;badgeEl.style.display='inline-block';}else{badgeEl.style.display='none';}}).catch(()=>{});},5000);
            setInterval(()=>{fetch('/api/admin/withdrawal_count').then(r=>r.json()).then(d=>{const badgeEl=document.getElementById('withdrawalsBadge');if(d.count>0&&d.count!==withdrawalCount){badgeEl.textContent=d.count;badgeEl.style.display='inline-block';if(localStorage.getItem('active_tab')!=='withdrawals'){showNotification('üí∏ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥!');}}else if(d.count>0){badgeEl.textContent=d.count;badgeEl.style.display='inline-block';}else{badgeEl.style.display='none';}withdrawalCount=d.count;}).catch(()=>{});},3000);
            // Update top stats periodically (but not the entire content)
            setInterval(()=>{
                if(document.getElementById('adminPanel')&&!document.getElementById('adminPanel').classList.contains('hidden')){
                    refreshTopStats();
                }
            },10000);
        }
        
        function refreshUsersOnly(){
            const searchInput = document.getElementById('userSearch');
            const searchTerm = searchInput ? searchInput.value : '';
            if(!window.allUsers) return;
            const c = document.getElementById('content');
            if(!c) return;
            const filteredUsers = searchTerm?window.allUsers.filter(u=>(u.username||'').toLowerCase().includes(searchTerm.toLowerCase())||u.telegram_id.toString().includes(searchTerm)):window.allUsers;
            c.innerHTML = '';
            const ul = document.createElement('div');
            filteredUsers.forEach(u=>{
                const card = document.createElement('div'); 
                card.className = 'user-card';
                card.innerHTML = `<div class="user-header"><div class="user-info"><h3>${u.username||'Unknown'}</h3><div class="user-id">ID: ${u.telegram_id}</div></div></div>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;">
<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:9px;"><div style="font-size:10px;color:#94a3b8;margin-bottom:5px;">üí∞ –ö–æ–∏–Ω—ã</div><div style="font-size:18px;font-weight:900;color:#fff;">${Math.floor(u.coins||0).toLocaleString()}</div></div>
<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:9px;"><div style="font-size:10px;color:#94a3b8;margin-bottom:5px;">üíé Hash</div><div style="font-size:18px;font-weight:900;color:#fff;">${Math.floor(u.quanhash||0).toLocaleString()}</div></div>
<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:9px;"><div style="font-size:10px;color:#94a3b8;margin-bottom:5px;">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div><div style="font-size:18px;font-weight:900;color:#fff;">${Math.floor(u.energy||0)}/${Math.floor(u.max_energy||0)}</div></div>
</div>
<div class="actions-grid">
<button class="action-btn btn-edit" onclick="openEditModal(${u.telegram_id},'coins','üí∞ –ö–æ–∏–Ω—ã',${Math.floor(u.coins||0)})">üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–∏–Ω—ã</button>
<button class="action-btn btn-edit" onclick="openEditModal(${u.telegram_id},'quanhash','üíé QuanHash',${Math.floor(u.quanhash||0)})">üíé –ò–∑–º–µ–Ω–∏—Ç—å Hash</button>
<button class="action-btn btn-edit" onclick="openEditModal(${u.telegram_id},'energy','‚ö° –≠–Ω–µ—Ä–≥–∏—è',${Math.floor(u.energy||0)})">‚ö° –ò–∑–º–µ–Ω–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é</button>
</div>
<div class="actions-grid">
<button class="action-btn ${u.is_banned?'btn-success':'btn-manage'}" onclick="toggleBan(${u.telegram_id},${u.is_banned})">${u.is_banned?'üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å':'üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}</button>
<button class="action-btn ${u.is_frozen?'btn-success':'btn-manage'}" onclick="toggleFreeze(${u.telegram_id},${u.is_frozen})">${u.is_frozen?'üî• –†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å':'‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å'}</button>
<button class="action-btn" style="background:linear-gradient(135deg,#a78bfa,#8b5cf6);" onclick="setReferrer(${u.telegram_id})">üë• –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞</button>
</div>
<div class="actions-grid">
<button class="action-btn btn-danger" onclick="resetUser(${u.telegram_id})" style="background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;font-weight:700;box-shadow:0 4px 15px rgba(239,68,68,0.3);">‚ö†Ô∏è –ü–û–õ–ù–´–ô –°–ë–†–û–°</button>
<button class="action-btn btn-danger" onclick="superResetUser(${u.telegram_id})" style="background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff;font-weight:700;box-shadow:0 4px 15px rgba(220,38,38,0.4);margin-left:5px;">üî• –°–£–ü–ï–† –°–ë–†–û–°</button>
<button class="action-btn" style="background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;" onclick="manageVIP(${u.telegram_id},${u.vip_level||0},'${u.vip_badge||''}',${u.has_premium_support||false},${u.has_golden_profile||false},${u.has_top_place||false},${u.has_unique_design||false})">üëë VIP –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
</div>`;
                ul.appendChild(card);
            });
            c.appendChild(ul);
        }
        
        function refreshWithdrawalsOnly(){
            fetch('/api/admin/withdrawals').then(r=>r.json()).then(d=>{
                const c = document.getElementById('content');
                if(!c || !c.innerHTML.includes('user-card')) return;
                if(d.requests&&d.requests.length>0){
                    c.innerHTML='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üí∏ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥ ('+d.requests.length+')</h2>';
                    d.requests.forEach(r=>{
                        const user=window.allUsers&&window.allUsers.find(u=>u.telegram_id===r.telegram_id);
                        const div=document.createElement('div');div.className='user-card';
                        const statusColor = r.status==='completed'?'rgba(16,185,129,0.2)':r.status==='rejected'?'rgba(239,68,68,0.2)':'rgba(245,158,11,0.2)';
                        const statusIcon = r.status==='completed'?'‚úÖ':r.status==='rejected'?'‚ùå':'‚è≥';
                        const statusText = r.status==='completed'?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':r.status==='rejected'?'–û—Ç–∫–ª–æ–Ω–µ–Ω–æ':'–û–∂–∏–¥–∞–µ—Ç';
                        const html='<div style="margin-bottom:16px;"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;"><div><div style="font-weight:800;font-size:20px;color:#fff;">–ó–∞—è–≤–∫–∞ #'+r.id+'</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">'+new Date(r.created_at).toLocaleString()+'</div></div><div style="padding:10px 20px;background:'+statusColor+';border-radius:12px;color:#fff;font-weight:700;font-size:14px;border:2px solid rgba(255,255,255,0.1);">'+statusIcon+' '+statusText+'</div></div></div><div style="background:rgba(0,0,0,0.3);padding:16px;border-radius:12px;margin-bottom:16px;"><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;"><div><div style="font-size:12px;color:#94a3b8;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(user?user.username:'Unknown')+'</div></div><div><div style="font-size:12px;color:#94a3b8;">Telegram ID:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(r.telegram_id||r.user_id)+'</div></div><div><div style="font-size:12px;color:#94a3b8;">–ö–æ–∏–Ω—ã:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(user?Math.floor(user.coins||0).toLocaleString():0)+'</div></div><div><div style="font-size:12px;color:#94a3b8;">QuanHash:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(user?Math.floor(user.quanhash||0).toLocaleString():0)+'</div></div></div><div style="margin-top:16px;padding:16px;background:rgba(102,126,234,0.15);border-radius:12px;border:2px solid rgba(102,126,234,0.3);"><div style="font-size:12px;color:#94a3b8;margin-bottom:8px;">–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞:</div><div style="font-size:28px;font-weight:900;color:#667eea;line-height:1.2;">üíé '+(r.amount||0).toLocaleString()+' QuanHash</div><div style="font-size:16px;color:#94a3b8;margin-top:8px;">‚âà $'+(parseFloat(r.usdt_amount||0)).toFixed(2)+' USDT</div></div><div style="margin-top:16px;"><div style="font-size:12px;color:#94a3b8;margin-bottom:10px;">–ê–¥—Ä–µ—Å BEP20:</div><div style="background:rgba(102,126,234,0.2);padding:16px;border-radius:12px;border:2px solid rgba(102,126,234,0.4);display:flex;align-items:center;gap:12px;"><div style="flex:1;font-family:monospace;font-size:13px;color:#fff;word-break:break-all;font-weight:600;">'+(r.address||'N/A')+'</div><button onclick="copyAddress(\''+(r.address||'')+'\')" style="padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:700;white-space:nowrap;box-shadow:0 4px 12px rgba(102,126,234,0.4);transition:all 0.3s;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div></div></div>';
                        const actions=r.status==='pending'?'<div class="actions-grid"><button class="action-btn btn-success" data-rid="'+r.id+'" data-status="completed" onclick="confirmWithdrawal(this,\'approved\')">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button><button class="action-btn btn-danger" data-rid="'+r.id+'" data-status="rejected" onclick="confirmWithdrawal(this,\'rejected\')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button></div>':'';
                        div.innerHTML=html+actions;
                        c.appendChild(div);
                    });
                }else{c.innerHTML='<div class="loading">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</div>';}
            });
        }
        
        function refreshQuestionsOnly(){
            fetch('/api/admin/support').then(r=>r.json()).then(d=>{
                const c = document.getElementById('content');
                if(!c) return;
                const activeTickets = (d.tickets || []).filter(t => t.status !== 'resolved');
                c.innerHTML = '<h2 style="color:#fff;font-size:20px;margin-bottom:20px;display:flex;align-items:center;">üí¨ –í–æ–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ('+activeTickets.length+')</h2>';
                activeTickets.forEach(t=>{
                    const div=document.createElement('div');div.className='user-card';
                    const html='<div style="margin-bottom:12px;"><div style="font-weight:800;font-size:16px;color:#fff;">'+t.topic+'</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">–û—Ç: '+(t.username||'Unknown')+' (ID: '+t.telegram_id+')</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">'+new Date(t.created_at).toLocaleString()+'</div></div><div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:10px;margin-bottom:12px;"><div style="font-size:14px;color:#fff;line-height:1.6;">'+t.message+'</div></div>';
                    const actions=t.status==='pending'?'<div class="actions-grid"><button class="action-btn" style="background:linear-gradient(135deg,#10b981,#059669);" onclick="answerQuestion('+t.id+')">üìù –û—Ç–≤–µ—Ç–∏—Ç—å</button><button class="action-btn" style="background:linear-gradient(135deg,#ef4444,#dc2626);" onclick="deleteTicket('+t.id+')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button></div>':t.status==='answered'?'<div class="actions-grid"><button class="action-btn" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);" onclick="archiveTicket('+t.id+')">üìÅ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button><button class="action-btn" style="background:linear-gradient(135deg,#ef4444,#dc2626);" onclick="deleteTicket('+t.id+')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button></div>':'<div style="padding:10px;background:rgba(99,102,241,0.2);border-radius:10px;color:#6366f1;text-align:center;font-weight:700;">üìÅ –í –∞—Ä—Ö–∏–≤–µ</div>';
                    div.innerHTML=html+actions;
                    c.appendChild(div);
                });
            });
        }
        
        function refreshArchiveOnly(){
            fetch('/api/admin/archive').then(r=>r.json()).then(d=>{
                const c = document.getElementById('content');
                if(!c) return;
                const archivedTickets = d.tickets || [];
                c.innerHTML = '<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üìÅ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ ('+archivedTickets.length+')</h2>';
                archivedTickets.forEach(t=>{
                    const div=document.createElement('div');div.className='user-card';
                    div.innerHTML='<div style="margin-bottom:12px;"><div style="font-weight:800;font-size:16px;color:#fff;">'+t.topic+'</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">–û—Ç: '+(t.username||'Unknown')+' (ID: '+t.telegram_id+')</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">'+new Date(t.created_at).toLocaleString()+'</div></div><div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:10px;margin-bottom:12px;"><div style="font-size:14px;color:#fff;line-height:1.6;">'+t.message+'</div></div><div style="background:rgba(99,102,241,0.1);padding:10px;border-radius:8px;"><div style="font-size:12px;color:#94a3b8;">–û—Ç–≤–µ—Ç:</div><div style="font-size:14px;color:#fff;margin-top:4px;">'+t.answer+'</div></div>';
                    c.appendChild(div);
                });
            });
        }
        
        function refreshStatsOnly(){
            fetch('/api/admin/stats').then(r=>r.json()).then(d=>{
                const c = document.getElementById('content');
                if(!c) return;
                c.innerHTML = '<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:30px;"><div class="stat-card"><div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div><div class="stat-value">'+(d.total_users||0)+'</div></div><div class="stat-card"><div class="stat-label">–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div><div class="stat-value">'+(d.total_taps||0).toLocaleString()+'</div></div><div class="stat-card"><div class="stat-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥</div><div class="stat-value">'+(d.total_revenue||0).toLocaleString()+'</div></div><div class="stat-card"><div class="stat-label">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥</div><div class="stat-value">'+(d.pending_withdrawals||0)+'</div></div></div>';
                document.getElementById('totalUsers').querySelector('.stat-value').textContent=d.total_users||0;
                document.getElementById('totalTaps').querySelector('.stat-value').textContent=(d.total_taps||0).toLocaleString();
                document.getElementById('totalRevenue').querySelector('.stat-value').textContent=(d.total_revenue||0).toLocaleString();
                document.getElementById('totalWithdrawals').querySelector('.stat-value').textContent=d.pending_withdrawals||0;
            });
        }
        
        function refreshTopStats(){
            fetch('/api/admin/stats').then(r=>r.json()).then(d=>{
                document.getElementById('totalUsers').querySelector('.stat-value').textContent=d.total_users||0;
                document.getElementById('totalTaps').querySelector('.stat-value').textContent=(d.total_taps||0).toLocaleString();
                document.getElementById('totalRevenue').querySelector('.stat-value').textContent=(d.total_revenue||0).toLocaleString();
                document.getElementById('totalWithdrawals').querySelector('.stat-value').textContent=d.pending_withdrawals||0;
            });
        }
        
        function loadStats(){
            const c=document.getElementById('content');c.innerHTML='<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            fetch('/api/admin/stats').then(r=>r.json()).then(d=>{
                document.getElementById('totalUsers').querySelector('.stat-value').textContent=d.total_users||0;
                document.getElementById('totalRevenue').querySelector('.stat-value').textContent=d.total_revenue||0;
                document.getElementById('totalActivity').querySelector('.stat-value').textContent=d.active_users||0;
                document.getElementById('totalWithdrawals').querySelector('.stat-value').textContent=d.pending_withdrawals||0;
                c.innerHTML='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;">'+
                    '<div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div><div class="stat-value">'+d.total_users+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üëÜ</div><div class="stat-label">–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div><div class="stat-value">'+Math.floor(d.total_taps||0).toLocaleString()+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥</div><div class="stat-value">'+Math.floor(d.total_revenue||0).toLocaleString()+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üí∏</div><div class="stat-label">–ó–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</div><div class="stat-value">'+d.pending_withdrawals+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">ü™ô</div><div class="stat-label">–í—Å–µ–≥–æ –∫–æ–∏–Ω–æ–≤</div><div class="stat-value">'+Math.floor(d.total_coins||0).toLocaleString()+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üíé</div><div class="stat-label">–í—Å–µ–≥–æ QuanHash</div><div class="stat-value">'+Math.floor(d.total_quanhash||0).toLocaleString()+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üîó</div><div class="stat-label">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div><div class="stat-value">'+Math.floor(d.total_referrals||0).toLocaleString()+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">‚ö°</div><div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div><div class="stat-value">'+d.active_users+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üîí</div><div class="stat-label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</div><div class="stat-value">'+d.banned_users+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üîß</div><div class="stat-label">–ú–∞—à–∏–Ω</div><div class="stat-value">'+d.total_machines+'</div></div>'+
                    '<div class="stat-card"><div class="stat-icon">üé¥</div><div class="stat-label">–ö–∞—Ä—Ç–æ—á–µ–∫</div><div class="stat-value">'+d.total_cards+'</div></div></div>';
            }).catch(()=>c.innerHTML='<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>');
        }
        
        let currentFilter = 'all';
        
        function filterUsersByCategory(category){
            currentFilter = category;
            filterUsers();
        }
        
        function filterUsers(){
            const searchInput = document.getElementById('userSearch');
            const searchTerm = searchInput ? searchInput.value : '';
            if(!window.allUsers) return;
            const c = document.getElementById('content');
            if(!c) return;
            
            let filteredUsers = window.allUsers;
            
            // Apply search filter
            if(searchTerm){
                filteredUsers = filteredUsers.filter(u=>(u.username||'').toLowerCase().includes(searchTerm.toLowerCase())||u.telegram_id.toString().includes(searchTerm));
            }
            
            // Apply category filter
            if(currentFilter === 'vip'){
                filteredUsers = filteredUsers.filter(u => (u.vip_level || 0) > 0);
            } else if(currentFilter === 'banned'){
                filteredUsers = filteredUsers.filter(u => u.is_banned);
            } else if(currentFilter === 'frozen'){
                filteredUsers = filteredUsers.filter(u => u.is_frozen);
            } else if(currentFilter === 'active'){
                filteredUsers = filteredUsers.filter(u => !u.is_banned && !u.is_frozen);
            }
            
            // Clear existing cards
            const userCardsContainer = c.querySelector('#userCardsContainer');
            if(!userCardsContainer) return;
            
            // Update active tab button
            document.querySelectorAll('.user-filter-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`.user-filter-btn[data-filter="${currentFilter}"]`);
            if(activeBtn) activeBtn.classList.add('active');
            
            // Render filtered users
            userCardsContainer.innerHTML = '';
            let visibleCount = 0;
            
            filteredUsers.forEach(u => {
                visibleCount++;
                const card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `<div class="user-header"><div class="user-info"><h3>${u.username||'Unknown'}</h3><div class="user-id">ID: ${u.telegram_id}</div></div></div>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;">
<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:9px;"><div style="font-size:10px;color:#94a3b8;margin-bottom:5px;">üí∞ –ö–æ–∏–Ω—ã</div><div style="font-size:18px;font-weight:900;color:#fff;">${Math.floor(u.coins||0).toLocaleString()}</div></div>
<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:9px;"><div style="font-size:10px;color:#94a3b8;margin-bottom:5px;">üíé Hash</div><div style="font-size:18px;font-weight:900;color:#fff;">${Math.floor(u.quanhash||0).toLocaleString()}</div></div>
<div style="text-align:center;padding:10px;background:rgba(0,0,0,0.3);border-radius:9px;"><div style="font-size:10px;color:#94a3b8;margin-bottom:5px;">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div><div style="font-size:18px;font-weight:900;color:#fff;">${Math.floor(u.energy||0)}/${Math.floor(u.max_energy||0)}</div></div>
</div>
<div class="actions-grid">
<button class="action-btn btn-edit" onclick="openEditModal(${u.telegram_id},'coins','üí∞ –ö–æ–∏–Ω—ã',${Math.floor(u.coins||0)})">üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–∏–Ω—ã</button>
<button class="action-btn btn-edit" onclick="openEditModal(${u.telegram_id},'quanhash','üíé QuanHash',${Math.floor(u.quanhash||0)})">üíé –ò–∑–º–µ–Ω–∏—Ç—å Hash</button>
<button class="action-btn btn-edit" onclick="openEditModal(${u.telegram_id},'energy','‚ö° –≠–Ω–µ—Ä–≥–∏—è',${Math.floor(u.energy||0)})">‚ö° –ò–∑–º–µ–Ω–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é</button>
</div>
<div class="actions-grid">
<button class="action-btn ${u.is_banned?'btn-success':'btn-manage'}" onclick="toggleBan(${u.telegram_id},${u.is_banned})">${u.is_banned?'üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å':'üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}</button>
<button class="action-btn ${u.is_frozen?'btn-success':'btn-manage'}" onclick="toggleFreeze(${u.telegram_id},${u.is_frozen})">${u.is_frozen?'üî• –†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å':'‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å'}</button>
<button class="action-btn" style="background:linear-gradient(135deg,#a78bfa,#8b5cf6);" onclick="setReferrer(${u.telegram_id})">üë• –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞</button>
</div>
<div class="actions-grid">
<button class="action-btn btn-danger" onclick="resetUser(${u.telegram_id})" style="background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;font-weight:700;box-shadow:0 4px 15px rgba(239,68,68,0.3);">‚ö†Ô∏è –ü–û–õ–ù–´–ô –°–ë–†–û–°</button>
<button class="action-btn btn-danger" onclick="superResetUser(${u.telegram_id})" style="background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff;font-weight:700;box-shadow:0 4px 15px rgba(220,38,38,0.4);margin-left:5px;">üî• –°–£–ü–ï–† –°–ë–†–û–°</button>
<button class="action-btn" style="background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;" onclick="manageVIP(${u.telegram_id},${u.vip_level||0},'${u.vip_badge||''}',${u.has_premium_support||false},${u.has_golden_profile||false},${u.has_top_place||false},${u.has_unique_design||false})">üëë VIP –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
</div>`;
                userCardsContainer.appendChild(card);
            });
            
            // Update count display
            const countEl = c.querySelector('#filterCount');
            if(countEl) countEl.textContent = `–ù–∞–π–¥–µ–Ω–æ: ${visibleCount}`;
            
            // Show "not found" message if no results
            if(visibleCount === 0 && (searchTerm || currentFilter !== 'all')){
                const notice = document.createElement('div');
                notice.style.cssText = 'padding:30px;text-align:center;color:#94a3b8;font-size:16px;font-weight:700;';
                notice.textContent = '‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                userCardsContainer.appendChild(notice);
            }
        }
        
        function loadUsers(){
            const c=document.getElementById('content');
            c.innerHTML='<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            fetch('/api/admin/users').then(r=>r.json()).then(d=>{
                if(d.users&&d.users.length>0){
                    window.allUsers=d.users;
                    c.innerHTML=`
<div style="margin-bottom:20px;">
<input type="text" id="userSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ ID..." style="width:100%;padding:14px 18px;background:rgba(0,0,0,0.3);border:2px solid rgba(99,102,241,0.2);border-radius:12px;color:#fff;font-size:15px;margin-bottom:16px;outline:none;transition:all 0.3s;" onfocus="this.style.borderColor='#667eea';this.style.boxShadow='0 0 20px rgba(102,126,234,0.3)'" onblur="this.style.borderColor='rgba(99,102,241,0.2)';this.style.boxShadow='none'" oninput="clearTimeout(searchTimeout);searchTimeout=setTimeout(()=>filterUsers(),300)">
<div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
<button class="user-filter-btn active" data-filter="all" onclick="filterUsersByCategory('all')" style="padding:10px 20px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;border-radius:12px;font-weight:700;font-size:13px;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 15px rgba(99,102,241,0.3);">üë• –í—Å–µ</button>
<button class="user-filter-btn" data-filter="active" onclick="filterUsersByCategory('active')" style="padding:10px 20px;background:rgba(99,102,241,0.2);color:#fff;border:2px solid rgba(99,102,241,0.3);border-radius:12px;font-weight:700;font-size:13px;cursor:pointer;transition:all 0.3s;">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ</button>
<button class="user-filter-btn" data-filter="vip" onclick="filterUsersByCategory('vip')" style="padding:10px 20px;background:rgba(255,215,0,0.1);color:#ffd700;border:2px solid rgba(255,215,0,0.3);border-radius:12px;font-weight:700;font-size:13px;cursor:pointer;transition:all 0.3s;">üëë VIP</button>
<button class="user-filter-btn" data-filter="banned" onclick="filterUsersByCategory('banned')" style="padding:10px 20px;background:rgba(239,68,68,0.1);color:#ef4444;border:2px solid rgba(239,68,68,0.3);border-radius:12px;font-weight:700;font-size:13px;cursor:pointer;transition:all 0.3s;">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</button>
<button class="user-filter-btn" data-filter="frozen" onclick="filterUsersByCategory('frozen')" style="padding:10px 20px;background:rgba(6,182,212,0.1);color:#06b6d4;border:2px solid rgba(6,182,212,0.3);border-radius:12px;font-weight:700;font-size:13px;cursor:pointer;transition:all 0.3s;">‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ</button>
</div>
<div id="filterCount" style="font-size:12px;color:#94a3b8;font-weight:700;margin-bottom:12px;">–ù–∞–π–¥–µ–Ω–æ: ${d.users.length}</div>
</div>
<div id="userCardsContainer"></div>`;
                    
                    // Render all users initially
                    filterUsers();
                }else{c.innerHTML='<div class="loading">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';}
            });
        }
        
        function manageVIP(uid,vipLevel,vipBadge,hasSupport,hasProfile,hasPlace,hasDesign){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'vipModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VIP-—Å—Ç–∞—Ç—É—Å–æ–º</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;">‚úï</button>
                    </div>
                    <div style="background:rgba(255,215,0,0.1);padding:15px;border-radius:12px;border:2px solid rgba(255,215,0,0.3);margin-bottom:20px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;color:#fff;">VIP —É—Ä–æ–≤–µ–Ω—å:</div>
                        <select id="vipLevel" style="width:100%;padding:12px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:12px;color:#fff;font-size:14px;outline:none;">
                            <option value="0" ${vipLevel==0?'selected':''}>0 - –û–±—ã—á–Ω—ã–π</option>
                            <option value="1" ${vipLevel==1?'selected':''}>1 - Bronze VIP</option>
                            <option value="2" ${vipLevel==2?'selected':''}>2 - Silver VIP</option>
                            <option value="3" ${vipLevel==3?'selected':''}>3 - Gold VIP</option>
                            <option value="4" ${vipLevel==4?'selected':''}>4 - Platinum VIP</option>
                            <option value="5" ${vipLevel==5?'selected':''}>5 - Diamond VIP</option>
                            <option value="6" ${vipLevel==6?'selected':''}>6 - Absolute VIP</option>
                        </select>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;font-size:14px;font-weight:600;margin-bottom:10px;color:#94a3b8;">VIP Badge:</label>
                        <select id="vipBadge" style="width:100%;padding:12px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:12px;color:#fff;font-size:14px;outline:none;">
                            <option value="">–ù–µ—Ç –∑–Ω–∞—á–∫–∞</option>
                            <option value="bronze_vip" ${vipBadge=='bronze_vip'?'selected':''}>Bronze VIP</option>
                            <option value="silver_vip" ${vipBadge=='silver_vip'?'selected':''}>Silver VIP</option>
                            <option value="gold_vip" ${vipBadge=='gold_vip'?'selected':''}>Gold VIP</option>
                            <option value="platinum_vip" ${vipBadge=='platinum_vip'?'selected':''}>Platinum VIP</option>
                            <option value="diamond_vip" ${vipBadge=='diamond_vip'?'selected':''}>Diamond VIP</option>
                            <option value="absolute_vip" ${vipBadge=='absolute_vip'?'selected':''}>Absolute VIP</option>
                        </select>
                    </div>
                    <div style="margin-bottom:20px;background:rgba(102,126,234,0.1);padding:15px;border-radius:12px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;color:#fff;">VIP –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏:</div>
                        <label style="display:flex;align-items:center;gap:10px;margin-bottom:8px;cursor:pointer;"><input type="checkbox" id="hasSupport" ${hasSupport?'checked':''}><span>Premium Support</span></label>
                        <label style="display:flex;align-items:center;gap:10px;margin-bottom:8px;cursor:pointer;"><input type="checkbox" id="hasProfile" ${hasProfile?'checked':''}><span>Golden Profile</span></label>
                        <label style="display:flex;align-items:center;gap:10px;margin-bottom:8px;cursor:pointer;"><input type="checkbox" id="hasPlace" ${hasPlace?'checked':''}><span>Top Place</span></label>
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;"><input type="checkbox" id="hasDesign" ${hasDesign?'checked':''}><span>Unique Design</span></label>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="saveVIPChanges(${uid})" style="flex:1;padding:14px;background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => {if(e.target === modal) modal.remove();};
        }
        
        function saveVIPChanges(uid){
            const vipLevel = parseInt(document.getElementById('vipLevel').value);
            const vipBadge = document.getElementById('vipBadge').value;
            const hasSupport = document.getElementById('hasSupport').checked;
            const hasProfile = document.getElementById('hasProfile').checked;
            const hasPlace = document.getElementById('hasPlace').checked;
            const hasDesign = document.getElementById('hasDesign').checked;
            
            const vipData = {
                vip_level: vipLevel,
                vip_badge: vipBadge,
                has_premium_support: hasSupport,
                has_golden_profile: hasProfile,
                has_top_place: hasPlace,
                has_unique_design: hasDesign
            };
            
            fetch('/api/admin/set_vip', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    user_id: uid,
                    vip_data: vipData
                })
            })
            .then(r => r.json())
            .then(d => {
                if(d.success) {
                    showNotification('‚úÖ VIP-—Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω');
                    document.getElementById('vipModal').remove();
                    loadUsers();
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (d.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
                }
            })
            .catch(() => showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è'));
        }
        
        function openEditModal(uid,field,title,currentValue){
            document.getElementById('modalTitle').textContent=title;
            document.getElementById('modalInput').value=currentValue||0;
            document.getElementById('quickEditModal').classList.add('active');
            quickEditData={userId:uid,field};
        }
        function closeModal(){document.getElementById('quickEditModal').classList.remove('active');quickEditData=null;}
        function confirmQuickEdit(){
            if(!quickEditData)return;
            const v=parseFloat(document.getElementById('modalInput').value);
            if(isNaN(v)){alert('‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ');return;}
            modifyUser(quickEditData.userId,'set_'+quickEditData.field,v);closeModal();
        }
        function toggleBan(uid,isBanned){
            if(isBanned){
                showUnbanModal(uid);
            }else{
                showBanModal(uid);
            }
        }
        function toggleFreeze(uid,isFrozen){
            if(isFrozen){
                showUnfreezeModal(uid);
            }else{
                showFreezeModal(uid);
            }
        }
        
        function showUnbanModal(uid){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'unbanModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;">‚úï</button>
                    </div>
                    <div style="margin-bottom:20px;background:rgba(16,185,129,0.1);padding:15px;border-radius:12px;border:2px solid rgba(16,185,129,0.3);">
                        <p style="color:#fff;font-size:14px;line-height:1.6;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?</p>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="modifyUser(${uid},'unban','Admin');document.getElementById('unbanModal').remove();" style="flex:1;padding:14px;background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => {if(e.target === modal) modal.remove();};
        }
        
        function showUnfreezeModal(uid){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'unfreezeModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">üî• –†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;">‚úï</button>
                    </div>
                    <div style="margin-bottom:20px;background:rgba(245,158,11,0.1);padding:15px;border-radius:12px;border:2px solid rgba(245,158,11,0.3);">
                        <p style="color:#fff;font-size:14px;line-height:1.6;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.</p>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="modifyUser(${uid},'unfreeze','');document.getElementById('unfreezeModal').remove();" style="flex:1;padding:14px;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;">üî• –†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => {if(e.target === modal) modal.remove();};
        }
        
        function showBanModal(uid){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'banModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 420px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;">‚úï</button>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;font-size:14px;font-weight:600;margin-bottom:10px;color:#94a3b8;">–°—Ä–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</label>
                        <select id="banDuration" style="width:100%;padding:12px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:12px;color:#fff;font-size:14px;outline:none;">
                            <option value="1">1 –¥–µ–Ω—å</option>
                            <option value="7">7 –¥–Ω–µ–π</option>
                            <option value="30">30 –¥–Ω–µ–π</option>
                            <option value="365">1 –≥–æ–¥</option>
                            <option value="-1">–ù–∞–≤—Å–µ–≥–¥–∞</option>
                        </select>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;font-size:14px;font-weight:600;margin-bottom:10px;color:#94a3b8;">–ü—Ä–∏—á–∏–Ω–∞:</label>
                        <textarea id="banReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏..." style="width:100%;min-height:80px;padding:12px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:12px;color:#fff;font-size:14px;resize:vertical;outline:none;"></textarea>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="confirmBan(${uid})" style="flex:1;padding:14px;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => {if(e.target === modal) modal.remove();};
        }
        
        function showFreezeModal(uid){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'freezeModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 420px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;">‚úï</button>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;font-size:14px;font-weight:600;margin-bottom:10px;color:#94a3b8;">–°—Ä–æ–∫ –∑–∞–º–æ—Ä–æ–∑–∫–∏:</label>
                        <select id="freezeDuration" style="width:100%;padding:12px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:12px;color:#fff;font-size:14px;outline:none;">
                            <option value="1">1 –¥–µ–Ω—å</option>
                            <option value="7">7 –¥–Ω–µ–π</option>
                            <option value="30">30 –¥–Ω–µ–π</option>
                            <option value="365">1 –≥–æ–¥</option>
                            <option value="-1">–ù–∞–≤—Å–µ–≥–¥–∞</option>
                        </select>
                    </div>
                    <div style="margin-bottom:20px;background:rgba(102,126,234,0.1);padding:15px;border-radius:12px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;color:#fff;">–ß—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å:</div>
                        <label style="display:flex;align-items:center;gap:10px;margin-bottom:8px;"><input type="checkbox" id="freezeTaps" checked><span>–¢–∞–ø—ã</span></label>
                        <label style="display:flex;align-items:center;gap:10px;margin-bottom:8px;"><input type="checkbox" id="freezeShop" checked><span>–ú–∞–≥–∞–∑–∏–Ω</span></label>
                        <label style="display:flex;align-items:center;gap:10px;"><input type="checkbox" id="freezeWithdraw" checked><span>–í—ã–≤–æ–¥</span></label>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="confirmFreeze(${uid})" style="flex:1;padding:14px;background:linear-gradient(135deg,#06b6d4,#0891b2);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;">‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => {if(e.target === modal) modal.remove();};
        }
        
        function confirmBan(uid){
            const duration = document.getElementById('banDuration').value;
            const reason = document.getElementById('banReason').value || '–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º';
            modifyUser(uid,'ban',reason+','+duration);
            document.getElementById('banModal').remove();
        }
        
        function confirmFreeze(uid){
            const duration = document.getElementById('freezeDuration').value;
            const freezeTaps = document.getElementById('freezeTaps').checked;
            const freezeShop = document.getElementById('freezeShop').checked;
            const freezeWithdraw = document.getElementById('freezeWithdraw').checked;
            const flags = (freezeTaps?1:0)+(freezeShop?2:0)+(freezeWithdraw?4:0);
            modifyUser(uid,'freeze',duration+','+flags);
            document.getElementById('freezeModal').remove();
        }
        function resetUser(uid){
            openResetUserModal(uid);
        }
        
        function openResetUserModal(uid){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:700px;background:linear-gradient(135deg,rgba(239,68,68,0.1),rgba(220,38,38,0.1));border:2px solid #ef4444;">
                    <div style="text-align:center;margin-bottom:25px;">
                        <div style="font-size:48px;margin-bottom:15px;">‚ö†Ô∏è</div>
                        <h2 style="color:#ef4444;font-size:24px;margin-bottom:10px;font-weight:800;">–ü–û–õ–ù–´–ô –°–ë–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø</h2>
                        <div style="color:#fca5a5;font-size:16px;line-height:1.5;">
                            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ <strong>–ù–ï–û–ë–†–ê–¢–ò–ú–û</strong> –∏ –æ–±–Ω—É–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
                        </div>
                    </div>
                    
                    <div style="background:rgba(239,68,68,0.2);padding:20px;border-radius:12px;margin-bottom:25px;border:1px solid rgba(239,68,68,0.3);">
                        <h3 style="color:#ef4444;font-size:18px;margin-bottom:15px;font-weight:700;">–ß—Ç–æ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–æ:</h3>
                        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;color:#fca5a5;font-size:14px;">
                            <div>üí∞ –ö–æ–∏–Ω—ã ‚Üí 0</div>
                            <div>üíé QuanHash ‚Üí 0</div>
                            <div>‚ö° –≠–Ω–µ—Ä–≥–∏—è ‚Üí 100</div>
                            <div>üìà –ú–∞–∫—Å–∏–º—É–º —ç–Ω–µ—Ä–≥–∏–∏ ‚Üí 100</div>
                            <div>üîÑ –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Üí 1</div>
                            <div>üí™ –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–∞–ø–∞ ‚Üí 1</div>
                            <div>ü§ñ –ê–≤—Ç–æ–±–æ—Ç ‚Üí –æ—Ç–∫–ª—é—á–µ–Ω</div>
                            <div>üëë VIP —Å—Ç–∞—Ç—É—Å ‚Üí —Å–±—Ä–æ—à–µ–Ω</div>
                            <div>üè≠ –ú–∞–π–Ω–∏–Ω–≥ –º–∞—à–∏–Ω—ã ‚Üí —É–¥–∞–ª–µ–Ω—ã</div>
                            <div>üí≥ –ö–∞—Ä—Ç–æ—á–∫–∏ ‚Üí —É–¥–∞–ª–µ–Ω—ã</div>
                            <div>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí —Å–±—Ä–æ—à–µ–Ω–∞</div>
                            <div>üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Üí —Å–±—Ä–æ—à–µ–Ω—ã</div>
                        </div>
                    </div>
                    
                    <div style="background:rgba(255,215,0,0.2);padding:15px;border-radius:10px;margin-bottom:25px;border:1px solid rgba(255,215,0,0.4);">
                        <div style="color:#fbbf24;font-weight:700;font-size:16px;margin-bottom:8px;">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!</div>
                        <div style="color:#fde68a;font-size:14px;">
                            –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
                        </div>
                    </div>
                    
                    <div style="margin-bottom:25px;">
                        <label style="display:block;color:#fca5a5;font-weight:700;margin-bottom:10px;font-size:16px;">
                            –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–±—Ä–æ—Å–∞:
                        </label>
                        <div style="display:flex;gap:10px;margin-bottom:15px;">
                            <label style="flex:1;display:flex;align-items:center;padding:15px;background:rgba(0,0,0,0.2);border:2px solid #ef4444;border-radius:10px;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='rgba(239,68,68,0.2)'" onmouseout="this.style.background='rgba(0,0,0,0.2)'">
                                <input type="radio" name="resetType" value="full" checked style="margin-right:10px;transform:scale(1.2);">
                                <div>
                                    <div style="color:#ef4444;font-weight:700;">üî• –ü–û–õ–ù–´–ô –°–ë–†–û–°</div>
                                    <div style="color:#fca5a5;font-size:12px;">–í—Å–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 0</div>
                                </div>
                            </label>
                            <label style="flex:1;display:flex;align-items:center;padding:15px;background:rgba(0,0,0,0.2);border:2px solid #f59e0b;border-radius:10px;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='rgba(245,158,11,0.2)'" onmouseout="this.style.background='rgba(0,0,0,0.2)'">
                                <input type="radio" name="resetType" value="soft" style="margin-right:10px;transform:scale(1.2);">
                                <div>
                                    <div style="color:#f59e0b;font-weight:700;">‚ö° –ú–Ø–ì–ö–ò–ô –°–ë–†–û–°</div>
                                    <div style="color:#fbbf24;font-size:12px;">–¢–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom:25px;">
                        <label style="display:block;color:#fca5a5;font-weight:700;margin-bottom:10px;font-size:16px;">
                            –í–≤–µ–¥–∏—Ç–µ "–°–ë–†–û–°–ò–¢–¨" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
                        </label>
                        <input type="text" id="resetConfirmation" placeholder="–°–ë–†–û–°–ò–¢–¨" 
                               style="width:100%;padding:15px;background:rgba(0,0,0,0.3);border:2px solid #ef4444;border-radius:10px;color:#fff;font-size:16px;text-align:center;font-weight:700;"
                               onkeyup="this.value=this.value.toUpperCase()">
                    </div>
                    
                    <div style="display:flex;gap:15px;">
                        <button class="btn-modal" style="flex:1;background:rgba(99,102,241,0.2);color:#fff;padding:15px;font-size:16px;font-weight:700;" 
                                onclick="this.closest('.modal').remove()">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                        <button class="btn-modal" id="confirmResetBtn" style="flex:1;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;padding:15px;font-size:16px;font-weight:700;" 
                                onclick="confirmUserReset('${uid}')" disabled>
                            ‚ö†Ô∏è –°–ë–†–û–°–ò–¢–¨
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤–≤–æ–¥–µ
            const confirmInput = document.getElementById('resetConfirmation');
            const confirmBtn = document.getElementById('confirmResetBtn');
            
            confirmInput.addEventListener('input', function() {
                if (this.value === '–°–ë–†–û–°–ò–¢–¨') {
                    confirmBtn.disabled = false;
                    confirmBtn.style.background = 'linear-gradient(135deg,#ef4444,#dc2626)';
                } else {
                    confirmBtn.disabled = true;
                    confirmBtn.style.background = 'rgba(239,68,68,0.3)';
                }
            });
        }
        
        function confirmUserReset(uid){
            const modal = document.querySelector('.modal.active');
            const confirmInput = document.getElementById('resetConfirmation');
            const resetType = document.querySelector('input[name="resetType"]:checked').value;
            
            if (confirmInput.value !== '–°–ë–†–û–°–ò–¢–¨') {
                showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            const resetTypeText = resetType === 'full' ? '–ü–û–õ–ù–´–ô –°–ë–†–û–°' : '–ú–Ø–ì–ö–ò–ô –°–ë–†–û–°';
            if (!confirm(`üö® –§–ò–ù–ê–õ–¨–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å ${resetTypeText} –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!`)) {
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingModal = document.createElement('div');
            loadingModal.className = 'modal active';
            loadingModal.innerHTML = `
                <div class="modal-content" style="max-width:500px;text-align:center;">
                    <div style="font-size:48px;margin-bottom:20px;">‚è≥</div>
                    <h2 style="color:#fff;font-size:24px;margin-bottom:15px;">–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö...</h2>
                    <div style="color:#94a3b8;font-size:16px;margin-bottom:20px;">
                        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.
                    </div>
                    <div style="background:rgba(0,0,0,0.3);padding:20px;border-radius:10px;">
                        <div style="color:#10b981;font-weight:700;font-size:14px;">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å...</div>
                    </div>
                </div>
            `;
            document.body.appendChild(loadingModal);
            modal.remove();
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–±—Ä–æ—Å
            fetch('/api/admin/reset_user', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    user_id: uid,
                    reset_type: resetType
                })
            })
            .then(response => response.json())
            .then(data => {
                loadingModal.remove();
                if (data.success) {
                    showNotification('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω!');
                    loadUsers();
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                loadingModal.remove();
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö');
            });
        }
        function setReferrer(uid){
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'referrerModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">üë• –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;">‚úï</button>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;font-size:14px;font-weight:600;margin-bottom:10px;color:#94a3b8;">Telegram ID —Ä–µ—Ñ–µ—Ä–µ—Ä–∞:</label>
                        <input type="number" id="referrerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ ID..." style="width:100%;padding:14px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:14px;color:#fff;font-size:16px;outline:none;transition:all 0.3s;" onfocus="this.style.borderColor='#667eea';this.style.boxShadow='0 0 20px rgba(102,126,234,0.3)';" onblur="this.style.borderColor='rgba(102,126,234,0.3)';this.style.boxShadow='none';">
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="confirmSetReferrer(${uid})" style="flex:1;padding:14px;background:linear-gradient(135deg,#a78bfa,#8b5cf6);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 15px rgba(167,139,250,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(167,139,250,0.5)';" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(167,139,250,0.3)';">‚úÖ –ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.2)';" onmouseout="this.style.background='rgba(255,255,255,0.1)';">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on outside click
            modal.onclick = (e) => {
                if(e.target === modal) modal.remove();
            };
        }
        
        function confirmSetReferrer(uid){
            const refId = document.getElementById('referrerInput').value;
            if(refId && !isNaN(refId)){
                modifyUser(uid,'set_referrer',parseInt(refId));
                document.getElementById('referrerModal').remove();
            } else {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID');
            }
        }
        function modifyUser(uid,a,v){
            fetch('/api/admin/modify_user',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:uid,action:a,value:v})}).then(r=>r.json()).then(()=>{showNotification('‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ');loadUsers();}).catch(()=>showNotification('‚ùå –û—à–∏–±–∫–∞'));
        }
        
        function loadWithdrawals(){
            const c=document.getElementById('content');c.innerHTML='<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            fetch('/api/admin/withdrawals').then(r=>r.json()).then(d=>{
                if(d.requests&&d.requests.length>0){
                    c.innerHTML='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üí∏ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥ ('+d.requests.length+')</h2>';
                    d.requests.forEach(r=>{
                        const user=window.allUsers&&window.allUsers.find(u=>u.telegram_id===r.telegram_id);
                        const div=document.createElement('div');div.className='user-card';
                        const statusColor = r.status==='completed'?'rgba(16,185,129,0.2)':r.status==='rejected'?'rgba(239,68,68,0.2)':'rgba(245,158,11,0.2)';
                        const statusIcon = r.status==='completed'?'‚úÖ':r.status==='rejected'?'‚ùå':'‚è≥';
                        const statusText = r.status==='completed'?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':r.status==='rejected'?'–û—Ç–∫–ª–æ–Ω–µ–Ω–æ':'–û–∂–∏–¥–∞–µ—Ç';
                        const html='<div style="margin-bottom:16px;"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;"><div><div style="font-weight:800;font-size:20px;color:#fff;">–ó–∞—è–≤–∫–∞ #'+r.id+'</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">'+new Date(r.created_at).toLocaleString()+'</div></div><div style="padding:10px 20px;background:'+statusColor+';border-radius:12px;color:#fff;font-weight:700;font-size:14px;border:2px solid rgba(255,255,255,0.1);">'+statusIcon+' '+statusText+'</div></div></div><div style="background:rgba(0,0,0,0.3);padding:16px;border-radius:12px;margin-bottom:16px;"><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;"><div><div style="font-size:12px;color:#94a3b8;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(user?user.username:'Unknown')+'</div></div><div><div style="font-size:12px;color:#94a3b8;">Telegram ID:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(r.telegram_id||r.user_id)+'</div></div><div><div style="font-size:12px;color:#94a3b8;">–ö–æ–∏–Ω—ã:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(user?Math.floor(user.coins||0).toLocaleString():0)+'</div></div><div><div style="font-size:12px;color:#94a3b8;">QuanHash:</div><div style="font-size:15px;color:#fff;font-weight:700;">'+(user?Math.floor(user.quanhash||0).toLocaleString():0)+'</div></div></div><div style="margin-top:16px;padding:16px;background:rgba(102,126,234,0.15);border-radius:12px;border:2px solid rgba(102,126,234,0.3);"><div style="font-size:12px;color:#94a3b8;margin-bottom:8px;">–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞:</div><div style="font-size:28px;font-weight:900;color:#667eea;line-height:1.2;">üíé '+(r.amount||0).toLocaleString()+' QuanHash</div><div style="font-size:16px;color:#94a3b8;margin-top:8px;">‚âà $'+(parseFloat(r.usdt_amount||0)).toFixed(2)+' USDT</div></div><div style="margin-top:16px;"><div style="font-size:12px;color:#94a3b8;margin-bottom:10px;">–ê–¥—Ä–µ—Å BEP20:</div><div style="background:rgba(102,126,234,0.2);padding:16px;border-radius:12px;border:2px solid rgba(102,126,234,0.4);display:flex;align-items:center;gap:12px;"><div style="flex:1;font-family:monospace;font-size:13px;color:#fff;word-break:break-all;font-weight:600;">'+(r.address||'N/A')+'</div><button onclick="copyAddress(\''+(r.address||'')+'\')" style="padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:700;white-space:nowrap;box-shadow:0 4px 12px rgba(102,126,234,0.4);transition:all 0.3s;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div></div></div>';
                        const actions=r.status==='pending'?'<div class="actions-grid"><button class="action-btn btn-success" data-rid="'+r.id+'" data-status="completed" onclick="confirmWithdrawal(this,\'approved\')">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button><button class="action-btn btn-danger" data-rid="'+r.id+'" data-status="rejected" onclick="confirmWithdrawal(this,\'rejected\')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button></div>':'';
                        div.innerHTML=html+actions;
                        c.appendChild(div);
                    });
                }else{c.innerHTML='<div class="loading">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</div>';}
            });
        }
        
        function copyAddress(address){
            navigator.clipboard.writeText(address).then(()=>{
                showNotification('üìã –ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(()=>showNotification('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è'));
        }
        
        function confirmWithdrawal(btn,type){
            const rid=btn.getAttribute('data-rid');
            const status=type==='approved'?'completed':'rejected';
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;">${type==='approved'?'‚úÖ –û–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫—É':'‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É'}</h2>
                        <button onclick="this.closest('.modal').remove()" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;">‚úï</button>
                    </div>
                    <div style="margin-bottom:20px;background:rgba(${type==='approved'?'16,185,129':'239,68,68'},0.1);padding:15px;border-radius:12px;border:2px solid rgba(${type==='approved'?'16,185,129':'239,68,68'},0.3);">
                        <p style="color:#fff;font-size:14px;line-height:1.6;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${type==='approved'?'–æ–¥–æ–±—Ä–∏—Ç—å':'–æ—Ç–∫–ª–æ–Ω–∏—Ç—å'} —ç—Ç—É –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥?</p>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button onclick="processWithdrawalBtnConfirmed(${rid},'${status}');document.getElementById('confirmModal').remove();" style="flex:1;padding:14px;background:linear-gradient(135deg,${type==='approved'?'#10b981,#059669':'#ef4444,#dc2626'});color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;">${type==='approved'?'‚úÖ –û–¥–æ–±—Ä–∏—Ç—å':'‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å'}</button>
                        <button onclick="this.closest('.modal').remove()" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            modal.id='confirmModal';
            document.body.appendChild(modal);
            modal.onclick = (e) => {if(e.target === modal) modal.remove();};
        }
        
        function processWithdrawalBtnConfirmed(rid,status){
            fetch('/api/admin/process_withdrawal',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({request_id:rid,status:status})}).then(()=>{showNotification(status==='completed'?'‚úÖ –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞':'‚ùå –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');loadWithdrawals();}).catch(()=>showNotification('‚ùå –û—à–∏–±–∫–∞'));
        }
        
        function processWithdrawalBtn(btn){const rid=btn.getAttribute('data-rid');const status=btn.getAttribute('data-status');fetch('/api/admin/process_withdrawal',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({request_id:rid,status:status})}).then(()=>{showNotification(status==='completed'?'‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ':'‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ');loadWithdrawals();}).catch(()=>showNotification('‚ùå –û—à–∏–±–∫–∞'));}
        
        function loadQuestions(){
            const c=document.getElementById('content');c.innerHTML='<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            fetch('/api/admin/support').then(r=>r.json()).then(d=>{
                const unreadCount = d.unread_count || 0;
                const badgeEl = document.getElementById('questionsBadge');
                if(unreadCount > 0) {
                    badgeEl.textContent = unreadCount;
                    badgeEl.style.display = 'inline-block';
                } else {
                    badgeEl.style.display = 'none';
                }
                const unreadBadge = unreadCount > 0 ? '<span style="background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:700;margin-left:10px;box-shadow:0 4px 12px rgba(239,68,68,0.4);">'+unreadCount+' –Ω–æ–≤–æ–µ</span>' : '';
                const activeTickets = (d.tickets || []).filter(t => t.status !== 'resolved');
                if(activeTickets.length>0){
                    c.innerHTML='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;display:flex;align-items:center;">üí¨ –í–æ–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ('+activeTickets.length+')'+unreadBadge+'</h2>';
                    activeTickets.forEach(t=>{
                        const div=document.createElement('div');div.className='user-card';
                        const html='<div style="margin-bottom:12px;"><div style="font-weight:800;font-size:16px;color:#fff;">'+t.topic+'</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">–û—Ç: '+(t.username||'Unknown')+' (ID: '+t.telegram_id+')</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">'+new Date(t.created_at).toLocaleString()+'</div></div><div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:10px;margin-bottom:12px;"><div style="font-size:14px;color:#fff;line-height:1.6;">'+t.message+'</div></div>';
                        const actions=t.status==='pending'?'<div class="actions-grid"><button class="action-btn" style="background:linear-gradient(135deg,#10b981,#059669);" onclick="answerQuestion('+t.id+')">üìù –û—Ç–≤–µ—Ç–∏—Ç—å</button><button class="action-btn" style="background:linear-gradient(135deg,#ef4444,#dc2626);" onclick="deleteTicket('+t.id+')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button></div>':t.status==='answered'?'<div class="actions-grid"><button class="action-btn" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);" onclick="archiveTicket('+t.id+')">üìÅ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button><button class="action-btn" style="background:linear-gradient(135deg,#ef4444,#dc2626);" onclick="deleteTicket('+t.id+')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button></div>':'<div style="padding:10px;background:rgba(99,102,241,0.2);border-radius:10px;color:#6366f1;text-align:center;font-weight:700;">üìÅ –í –∞—Ä—Ö–∏–≤–µ</div>';
                        div.innerHTML=html+actions;
                        c.appendChild(div);
                    });
                }else{c.innerHTML='<div class="loading">–ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</div>';}
            }).catch(()=>c.innerHTML='<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>');
        }
        
        function answerQuestion(id){
            // Create beautiful modal for answer
            const modal = document.createElement('div');
            modal.id = 'answerModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:10000;backdrop-filter:blur(10px);';
            modal.innerHTML = `
                <div style="background:linear-gradient(135deg,#1e3a5f,#2d4a6a);padding:30px;border-radius:20px;max-width:500px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.5);border:2px solid rgba(102,126,234,0.3);">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h2 style="color:#fff;font-size:22px;font-weight:700;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</h2>
                        <button id="closeAnswerModal" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);border-radius:8px;width:32px;height:32px;color:#fff;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;">‚úï</button>
                    </div>
                    <textarea id="answerText" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." style="width:100%;min-height:150px;padding:15px;background:rgba(0,0,0,0.4);border:2px solid rgba(102,126,234,0.3);border-radius:12px;color:#fff;font-size:14px;outline:none;resize:vertical;transition:all 0.3s;" onfocus="this.style.borderColor='#667eea';this.style.boxShadow='0 0 20px rgba(102,126,234,0.3)';" onblur="this.style.borderColor='rgba(102,126,234,0.3)';this.style.boxShadow='none';"></textarea>
                    <div style="display:flex;gap:10px;margin-top:20px;">
                        <button id="sendAnswer" style="flex:1;padding:14px;background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 15px rgba(16,185,129,0.3);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(16,185,129,0.5)';" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(16,185,129,0.3)';">
                            üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                        <button id="cancelAnswer" style="padding:14px 24px;background:rgba(255,255,255,0.1);color:#fff;border:2px solid rgba(255,255,255,0.3);border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.2)';" onmouseout="this.style.background='rgba(255,255,255,0.1)';">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on X
            document.getElementById('closeAnswerModal').onclick = () => modal.remove();
            
            // Close on cancel
            document.getElementById('cancelAnswer').onclick = () => modal.remove();
            
            // Send answer
            document.getElementById('sendAnswer').onclick = () => {
                const msg = document.getElementById('answerText').value.trim();
                if(!msg){
                    showNotification('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç');
                    return;
                }
                
                fetch('/api/admin/answer_ticket', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        ticket_id: id,
                        answer: msg
                    })
                })
                .then(r => r.json())
                .then(d => {
                    if(d.success) {
                        showNotification('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é');
                        modal.remove();
                        loadQuestions();
                    } else {
                        showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (d.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
                    }
                })
                .catch(() => showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏'));
            };
            
            // Close on outside click
            modal.onclick = (e) => {
                if(e.target === modal) modal.remove();
            };
        }
        
        function deleteTicket(id){
            if(!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) return;
            fetch('/api/admin/delete_ticket', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ticket_id: id})
            })
            .then(r => r.json())
            .then(d => {
                if(d.success) {
                    showNotification('üóëÔ∏è –í–æ–ø—Ä–æ—Å —É–¥–∞–ª–µ–Ω');
                    loadQuestions();
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (d.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
                }
            })
            .catch(() => showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è'));
        }
        
        function archiveTicket(id){
            fetch('/api/admin/archive_ticket', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ticket_id: id})
            })
            .then(r => r.json())
            .then(d => {
                if(d.success) {
                    showNotification('üìÅ –í–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∞—Ä—Ö–∏–≤');
                    loadQuestions();
                    // Switch to archive tab after archiving
                    setTimeout(() => {
                        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                        const archiveBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => btn.textContent.includes('–ê—Ä—Ö–∏–≤'));
                        if(archiveBtn) {
                            archiveBtn.classList.add('active');
                            loadTab('archive');
                        }
                    }, 500);
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (d.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
                }
            })
            .catch(() => showNotification('‚ùå –û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è'));
        }
        
        function loadArchive(){
            const c=document.getElementById('content');c.innerHTML='<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            fetch('/api/admin/support').then(r=>r.json()).then(d=>{
                const archivedTickets = (d.tickets || []).filter(t => t.status === 'resolved');
                if(archivedTickets.length > 0){
                    c.innerHTML='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üìÅ –ê—Ä—Ö–∏–≤ –≤–æ–ø—Ä–æ—Å–æ–≤ ('+archivedTickets.length+')</h2>';
                    archivedTickets.forEach(t=>{
                        const div=document.createElement('div');div.className='user-card';
                        const html='<div style="margin-bottom:12px;"><div style="font-weight:800;font-size:16px;color:#fff;">'+t.topic+'</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">–û—Ç: '+(t.username||'Unknown')+' (ID: '+t.telegram_id+')</div><div style="font-size:12px;color:#94a3b8;margin-top:4px;">'+new Date(t.created_at).toLocaleString()+'</div></div><div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:10px;margin-bottom:12px;"><div style="font-size:14px;color:#fff;line-height:1.6;">'+t.message+'</div></div>';
                        const statusDiv='<div style="padding:10px;background:rgba(99,102,241,0.2);border-radius:10px;color:#6366f1;text-align:center;font-weight:700;">üìÅ –ê—Ä—Ö–∏–≤</div>';
                        div.innerHTML=html+statusDiv;
                        c.appendChild(div);
                    });
                }else{c.innerHTML='<div class="loading">–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</div>';}
            }).catch(()=>c.innerHTML='<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>');
        }
        
        function loadSettings(){
            const arr=['–≠–Ω–µ—Ä–≥–∏—è','–¢–∞–ø—ã','–ö–æ–∏–Ω—ã','Hash','–ë—É—Å—Ç—ã','–†–µ—Ñ–µ—Ä–∞–ª—ã','–í—ã–≤–æ–¥','–î–∏–∑–∞–π–Ω','–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞','–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è','API','–ê–≤—Ç–æ–æ–±–Ω–æ–≤','–ú–æ–±–∏–ª—å–Ω–∞—è','–ë–∞–ª–∞–Ω—Å','–î–æ—Å—Ç—É–ø','–•—Ä–∞–Ω–µ–Ω–∏–µ','–ê–Ω–∞–ª–∏—Ç–∏–∫–∞','–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è','–¢—É—Ä–Ω–∏—Ä—ã','–ë–æ—Ç—ã','–†–∞—Å—Å—ã–ª–∫–∞'];
            let html='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2><div class="settings-grid">';
            arr.forEach(s=>{
                const msg='‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞: '+s;
                html+='<div class="setting-card"><div class="card-title">‚öôÔ∏è '+s+'</div><div class="card-desc">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ '+s.toLowerCase()+'</div><div class="card-actions"><button class="btn-modal" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;" data-msg="'+msg+'">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button></div></div>';
            });
            html+='</div>';
            document.getElementById('content').innerHTML=html;
            document.querySelectorAll('.setting-card .btn-modal').forEach(btn=>{
                btn.addEventListener('click',()=>showNotification(btn.getAttribute('data-msg')));
            });
        }
        
        function loadSecurity(){
            const arr=['DDoS –∑–∞—â–∏—Ç–∞','2FA –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è','Anti-Bot','–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ','–õ–æ–≥–∏–Ω—ã','–ü–∞—Ä–æ–ª–∏','–§–∞–π—Ä–≤–æ–ª','–ê—É–¥–∏—Ç','–û–ø–æ–≤–µ—â–µ–Ω–∏—è','–†–µ–∑–µ—Ä–≤–Ω—ã–π –ë—ç–∫–∞–ø','–ê–≤—Ç–æ–±–∞–Ω','–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å','SSL/TLS','IDS','–†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π','IP Whitelist','Rate Limiting','–ê–Ω—Ç–∏–≤–∏—Ä—É—Å','–ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π','–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–Ω–æ–º–∞–ª–∏–π'];
            let html='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã</h2><div class="security-grid">';
            arr.forEach(s=>{
                const msg='üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: '+s;
                html+='<div class="security-card"><div class="card-title">üîí '+s+'</div><div class="card-desc">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: '+s.toLowerCase()+'</div><div class="card-actions"><button class="btn-modal" style="background:linear-gradient(135deg,#8b5cf6,#a78bfa);color:#fff;" data-msg="'+msg+'">üîí –ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button></div></div>';
            });
            html+='</div>';
            document.getElementById('content').innerHTML=html;
            document.querySelectorAll('.security-card .btn-modal').forEach(btn=>{
                btn.addEventListener('click',()=>showNotification(btn.getAttribute('data-msg')));
            });
        }
        
        function loadTools(){
            const arr=['–ê–Ω–∞–ª–∏–∑ –ë–î','–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö','–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö','–¢–µ—Å—Ç API','–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã','–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤','–ü—Ä–æ–º–æ –∞–∫—Ü–∏–∏','–¢—É—Ä–Ω–∏—Ä—ã','–ü–æ–¥–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º','–ö—ç—à –æ—á–∏—Å—Ç–∫–∞','–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞','–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π','–ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥','–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á','–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏','Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è','A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'];
            let html='<h2 style="color:#fff;font-size:20px;margin-bottom:20px;">üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2><div class="tools-grid"><div class="tool-card"><div class="card-title">üì® –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</div><div class="card-desc">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</div><div class="card-actions"><button class="btn-modal" style="background:linear-gradient(135deg,#a78bfa,#c084fc);color:#fff;padding:10px 20px;width:100%;" id="massNotifyBtn">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div></div>';
            arr.forEach(s=>{
                const msg='üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: '+s;
                html+='<div class="tool-card"><div class="card-title">üõ†Ô∏è '+s+'</div><div class="card-desc">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: '+s.toLowerCase()+'</div><div class="card-actions"><button class="btn-modal" style="background:linear-gradient(135deg,#a78bfa,#c084fc);color:#fff;" data-msg="'+msg+'">üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button></div></div>';
            });
            html+='</div>';
            document.getElementById('content').innerHTML=html;
            document.getElementById('massNotifyBtn').addEventListener('click',openMassNotifyModal);
            document.querySelectorAll('.tool-card .btn-modal').forEach(btn=>{
                if(btn.getAttribute('data-msg'))btn.addEventListener('click',()=>showNotification(btn.getAttribute('data-msg')));
            });
        }
        
        function openMassNotifyModal(){
            const modal=document.createElement('div');modal.className='modal active';
            modal.innerHTML=`<div class="modal-content" style="max-width:600px;">
<h2 class="modal-title">üì® –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</h2>
<textarea id="notifyMessage" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è..." style="width:100%;min-height:150px;padding:14px;background:rgba(0,0,0,0.3);border:1px solid rgba(99,102,241,0.2);border-radius:11px;color:#fff;font-size:15px;margin-bottom:18px;"></textarea>
<div class="modal-actions">
<button class="btn-modal" style="background:rgba(99,102,241,0.2);color:#fff;" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn-modal" style="background:linear-gradient(135deg,#a78bfa,#c084fc);color:#fff;" onclick="sendMassNotification()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º</button>
</div></div>`;
            document.body.appendChild(modal);
        }
        
        function sendMassNotification(){
            const msg=document.getElementById('notifyMessage').value;
            if(!msg){alert('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');return;}
            fetch('/api/admin/mass_notify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})}).then(r=>r.json()).then(d=>{
                if(d.success){showNotification('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');document.querySelector('.modal.active').remove();}
                else showNotification('‚ùå –û—à–∏–±–∫–∞: '+d.error);
            }).catch(()=>showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏'));
        }
        
        function superResetUser(uid) {
            // –ö—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:600px;background:linear-gradient(135deg,rgba(220,38,38,0.15),rgba(185,28,28,0.15));border:3px solid #dc2626;box-shadow:0 20px 60px rgba(220,38,38,0.4);">
                    <div style="text-align:center;margin-bottom:30px;">
                        <div style="font-size:64px;margin-bottom:20px;animation:pulse 2s infinite;">üî•</div>
                        <h2 style="color:#dc2626;font-size:28px;margin-bottom:15px;font-weight:900;text-shadow:0 2px 4px rgba(0,0,0,0.3);">–°–£–ü–ï–† –°–ë–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø</h2>
                        <div style="color:#fca5a5;font-size:18px;line-height:1.6;font-weight:600;">
                            –ü–æ–ª–Ω–æ–µ –æ–±–Ω—É–ª–µ–Ω–∏–µ –í–°–ï–• –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        </div>
                    </div>
                    
                    <div style="background:rgba(220,38,38,0.25);padding:25px;border-radius:16px;margin-bottom:30px;border:2px solid rgba(220,38,38,0.4);">
                        <h3 style="color:#dc2626;font-size:20px;margin-bottom:20px;font-weight:800;text-align:center;">üö® –ß–¢–û –ë–£–î–ï–¢ –°–ë–†–û–®–ï–ù–û:</h3>
                        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;color:#fca5a5;font-size:15px;font-weight:600;">
                            <div style="display:flex;align-items:center;gap:8px;">üí∞ –ö–æ–∏–Ω—ã ‚Üí 0</div>
                            <div style="display:flex;align-items:center;gap:8px;">üíé QuanHash ‚Üí 0</div>
                            <div style="display:flex;align-items:center;gap:8px;">‚ö° –≠–Ω–µ—Ä–≥–∏—è ‚Üí 1000</div>
                            <div style="display:flex;align-items:center;gap:8px;">üìà –ú–∞–∫—Å–∏–º—É–º —ç–Ω–µ—Ä–≥–∏–∏ ‚Üí 1000</div>
                            <div style="display:flex;align-items:center;gap:8px;">üîÑ –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Üí 1</div>
                            <div style="display:flex;align-items:center;gap:8px;">üí™ –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–∞–ø–∞ ‚Üí 1</div>
                            <div style="display:flex;align-items:center;gap:8px;">ü§ñ –ê–≤—Ç–æ–±–æ—Ç ‚Üí –æ—Ç–∫–ª—é—á–µ–Ω</div>
                            <div style="display:flex;align-items:center;gap:8px;">üëë VIP —Å—Ç–∞—Ç—É—Å ‚Üí —Å–±—Ä–æ—à–µ–Ω</div>
                            <div style="display:flex;align-items:center;gap:8px;">üè≠ –ú–∞–π–Ω–∏–Ω–≥ –º–∞—à–∏–Ω—ã ‚Üí —É–¥–∞–ª–µ–Ω—ã</div>
                            <div style="display:flex;align-items:center;gap:8px;">üí≥ –ö–∞—Ä—Ç–æ—á–∫–∏ ‚Üí —É–¥–∞–ª–µ–Ω—ã</div>
                            <div style="display:flex;align-items:center;gap:8px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí —Å–±—Ä–æ—à–µ–Ω–∞</div>
                            <div style="display:flex;align-items:center;gap:8px;">üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Üí —Å–±—Ä–æ—à–µ–Ω—ã</div>
                            <div style="display:flex;align-items:center;gap:8px;">üõí –£—Ä–æ–≤–Ω–∏ –º–∞–≥–∞–∑–∏–Ω–∞ ‚Üí 0</div>
                            <div style="display:flex;align-items:center;gap:8px;">üéÆ –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å ‚Üí 0</div>
                        </div>
                    </div>
                    
                    <div style="background:rgba(255,215,0,0.25);padding:20px;border-radius:12px;margin-bottom:30px;border:2px solid rgba(255,215,0,0.5);">
                        <div style="color:#fbbf24;font-weight:800;font-size:18px;margin-bottom:10px;text-align:center;">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!</div>
                        <div style="color:#fde68a;font-size:16px;text-align:center;font-weight:600;">
                            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω—É–ª–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
                        </div>
                    </div>
                    
                    <div style="display:flex;gap:20px;">
                        <button class="btn-modal" style="flex:1;background:rgba(99,102,241,0.3);color:#fff;padding:18px;font-size:18px;font-weight:700;border-radius:12px;border:2px solid rgba(99,102,241,0.5);" 
                                onclick="this.closest('.modal').remove()">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                        <button class="btn-modal" style="flex:1;background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff;padding:18px;font-size:18px;font-weight:800;border-radius:12px;box-shadow:0 6px 20px rgba(220,38,38,0.4);" 
                                onclick="executeSuperReset('${uid}')">
                            üî• –í–´–ü–û–õ–ù–ò–¢–¨ –°–£–ü–ï–† –°–ë–†–û–°
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function executeSuperReset(uid) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingModal = document.createElement('div');
            loadingModal.className = 'modal active';
            loadingModal.innerHTML = `
                <div class="modal-content" style="max-width:500px;text-align:center;">
                    <div style="font-size:64px;margin-bottom:20px;animation:spin 1s linear infinite;">‚ö°</div>
                    <h2 style="color:#dc2626;font-size:24px;margin-bottom:15px;font-weight:800;">–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø –°–£–ü–ï–† –°–ë–†–û–°</h2>
                    <div style="color:#fca5a5;font-size:16px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>
                </div>
            `;
            document.body.appendChild(loadingModal);
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Å—É–ø–µ—Ä —Å–±—Ä–æ—Å
            fetch('/api/admin/super_reset_user', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_id: uid})
            })
            .then(res => res.json())
            .then(data => {
                loadingModal.remove();
                
                if (data.success) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    const successModal = document.createElement('div');
                    successModal.className = 'modal active';
                    successModal.innerHTML = `
                        <div class="modal-content" style="max-width:500px;text-align:center;">
                            <div style="font-size:64px;margin-bottom:20px;color:#10b981;">‚úÖ</div>
                            <h2 style="color:#10b981;font-size:24px;margin-bottom:15px;font-weight:800;">–°–£–ü–ï–† –°–ë–†–û–° –í–´–ü–û–õ–ù–ï–ù!</h2>
                            <div style="color:#6ee7b7;font-size:16px;margin-bottom:25px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω—É–ª–µ–Ω</div>
                            <button class="btn-modal" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:15px 30px;font-size:16px;font-weight:700;border-radius:10px;" 
                                    onclick="this.closest('.modal').remove();refreshUsers();">
                                üéâ –ì–æ—Ç–æ–≤–æ
                            </button>
                        </div>
                    `;
                    document.body.appendChild(successModal);
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(() => {
                loadingModal.remove();
                showNotification('‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—É–ø–µ—Ä —Å–±—Ä–æ—Å–∞');
            });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        
        window.addEventListener('load',()=>{if(localStorage.getItem('admin_logged_in')==='true'){document.getElementById('loginForm').classList.add('hidden');document.getElementById('adminPanel').classList.remove('hidden');initPanel();}});
    </script>
</body>
</html>

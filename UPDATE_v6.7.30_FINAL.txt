#!/bin/bash

# Quantum Nexus v6.7.30 - Enhanced Referral System FINAL
# Increased bonuses, detailed UI with premium indicators
# Date: 2025-11-03

echo "=================================================="
echo "Quantum Nexus v6.7.30 - Enhanced Referral System"
echo "FINAL VERSION"
echo "=================================================="
echo ""
echo "Changes:"
echo "  âœ… 500 ðŸª™ bonus for regular users (was 100)"
echo "  âœ… 2000 ðŸª™ bonus for premium users (was 250)"
echo "  âœ… Beautiful detailed UI with premium indicators"
echo "  âœ… Enhanced referral cards with gradients"
echo "  âœ… More information and better visual design"
echo ""

# Navigate to the application directory
cd /root/quantum-nexus

echo "Step 1: Remove backup files..."
rm -f web_app.html.backup web_server.py.backup 2>/dev/null

echo "Step 2: Pull latest changes from GitHub..."
git pull origin main

echo "Step 3: Backup current database..."
sudo -u postgres pg_dump quantum_nexus > /root/quantum-nexus-backup-$(date +%Y%m%d-%H%M%S).sql 2>/dev/null

echo "Step 4: Apply database migration (if not already done)..."
sudo -u postgres psql quantum_nexus -f ADD_IS_PREMIUM.sql 2>/dev/null || echo "Migration already applied or skipped"

echo "Step 5: Copy updated files..."
sudo cp web_app.html /var/www/quantum-nexus/web_app.html
sudo cp web_server.py /var/www/quantum-nexus/web_server.py
sudo cp handlers.py /var/www/quantum-nexus/handlers.py
sudo cp models.py /var/www/quantum-nexus/models.py
sudo cp config.py /var/www/quantum-nexus/config.py

echo "Step 6: Restart services..."
sudo systemctl restart quantum-nexus-web.service
sudo systemctl restart quantum-nexus.service

echo "Step 7: Check service status..."
echo ""
echo "quantum-nexus-web.service status:"
sudo systemctl status quantum-nexus-web.service --no-pager
echo ""
echo "quantum-nexus.service status:"
sudo systemctl status quantum-nexus.service --no-pager

echo ""
echo "=================================================="
echo "âœ… Deployment of v6.7.30 complete!"
echo "=================================================="
echo ""
echo "New Features:"
echo "  â€¢ 500 ðŸª™ bonus for regular users (5x increase!)"
echo "  â€¢ 2000 ðŸª™ bonus for premium users (8x increase!)"
echo "  â€¢ Beautiful detailed referral UI"
echo "  â€¢ Premium indicators in referral cards"
echo "  â€¢ Better visual design with gradients and shadows"
echo "  â€¢ More information displayed clearly"
echo ""

